"""
Codice per tdEIT offline da raw data (16 electrodes, 208 measurements)
"""
from __future__ import division, absolute_import, print_function
import logging
import itertools
import time
import threading
import numpy as np
import matplotlib.pyplot as plt
from pyeit import mesh 
from pyeit.eit.utils import eit_scan_lines
import pyeit.eit.protocol as protocol
from pyeit.eit.bp import BP as bp
from pyeit.eit.fem import EITForward

logger = logging.getLogger(__name__)


#def update_reference(self,data):
#    baseline_flag = 1

def eit_reconstruction(data):
    """bp.py in reconstruction
    Reconstruct an image from the measurements given by `data`.
    """
    # setup EIT scan conditions
    img = []
    baseline_flag = 1
    n_el = 8 # number of electrodes. 
    step = 1 
    el_dist = int(n_el/2) # random initialize number 

    # we create this according to an opposition protocol to maximize contrast. 
    ex_mat = eit_scan_lines(n_el =n_el, dist =el_dist)
    """ 0. construct mesh """
    # h0 is initial mesh size. , h0=0.1
    mesh_obj, el_pos = mesh.create(n_el)
    """ 3. Set Up BP """
    eit =  bp(mesh_obj,el_pos, ex_mat=ex_mat, step=step, parser='std')

    eit.setup(weight='none')

    try: 
        if baseline_flag == 1:
            f0 = np.array(data)
            baseline_flag = 0 
        # data contains fl.v and f0.v 
        f1 = np.array(data)
        # if the jacobian is not normalized, data may not to be normalized too.
        ds_bp = eit.solve(f1, f0, normalize=True)
        img = np.real(ds_bp)

    except RuntimeError as err:
        logger.error('reconstruction problem: %s', err)

    return img

def parse_line(line):
    try:
        _, data = line.split(";", 1)
    except ValueError:
        return None
    items = []
    for item in data.split(";"):
        item = item.strip()
        if not item:
            continue
        try:
            items.append(float(item))
        except ValueError:
            return None
    return np.array(items)

n_el = 8
""" Load Data: select a file you have created by simdata.py, or recorded through the dashboard """
text_file = open("data.csv", "r")
lines       = text_file.readlines()
print ("length lines: ",len(lines))
# This is the baseline image.
#f0= parse_line(lines[0])
# this is the new difference image. 
#f1= parse_line(lines[1])

'''
#10000 ohm calibration
#f0 = np.array([10469.00,10469.00,10469.00,10469.00,10469.00,10469.00,10469.00,10469.00,10469.00,10000.00,10469.00,10469.00,9686.88,10867.54,9686.88,10469.00,10469.00,10469.00,10469.00,9686.88,10000.00,10469.00,10469.00,10000.00,10000.00,10000.00,10867.54,10000.00,10000.00,10000.00,9686.88,9686.88,9686.88,9686.88,9686.88,9686.88,10867.54,10000.00,9686.88,10867.54])
#f1 = np.array([9003.62,10469.00,10000.00,10469.00,10000.00,11368.61,10000.00,9686.88,9253.38,10469.00,10469.00,9686.88,9686.88,10000.00,9003.62,10000.00,9003.62,10867.54,10867.54,10469.00,9686.88,10867.54,10867.54,9686.88,10000.00,10000.00,10469.00,10469.00,10469.00,10469.00,10867.54,9686.88,9686.88,10469.00,10469.00,9686.88,10867.54,10867.54,9686.88,10867.54])
#f2 = np.array([10000.00,9253.38,10867.54,10469.00,10469.00,9686.88,10867.54,10469.00,9686.88,10000.00,9686.88,10469.00,9253.38,10000.00,10000.00,9686.88,9686.88,9003.62,10000.00,9686.88,9686.88,9686.88,10000.00,10000.00,9686.88,9686.88,10469.00,9686.88,9686.88,10000.00,10867.54,10000.00,10469.00,9003.62,10867.54,10469.00,10000.00,10000.00,10867.54,8724.17])
#f3 = np.array([10469.00,10867.54,10469.00,9686.88,9686.88,10469.00,9686.88,10000.00,10000.00,9253.38,9253.38,10469.00,9686.88,10867.54,10469.00,10000.00,9686.88,9253.38,9686.88,9686.88,9341.37,10867.54,10867.54,9686.88,10000.00,9686.88,10867.54,10469.00,10000.00,9686.88,9003.62,9686.88,9686.88,10469.00,9003.62,9686.88,10000.00,10469.00,9686.88,10000.00])
#f4 = np.array([10000.00,9686.88,10000.00,10000.00,10469.00,9253.38,9686.88,9686.88,9686.88,10000.00,10000.00,9686.88,10000.00,10000.00,10000.00,9686.88,9686.88,10000.00,9686.88,10867.54,10000.00,9686.88,10867.54,9686.88,9253.38,10000.00,10867.54,10000.00,9686.88,9253.38,10469.00,9686.88,10000.00,9686.88,9686.88,10000.00,10000.00,10469.00,10000.00,10000.00])

#f1 = np.array([9253.38,10867.54,10867.54,10867.54,10867.54,10867.54,11368.61,10000.00,10867.54,10867.54,10000.00,10000.00,9686.88,10867.54,10867.54,9686.88,9686.88,10000.00,9686.88,10000.00,10000.00,10000.00,10469.00,10000.00,10469.00,10469.00,10469.00,9686.88,10867.54,9686.88,10867.54,9253.38,9686.88,10469.00,10000.00,10000.00,10867.54,10469.00,10000.00,10469.00])
#f2 = np.array([10469.00,10000.00,10867.54,10000.00,10000.00,10867.54,10469.00,10000.00,10867.54,10469.00,10000.00,9686.88,9686.88,9686.88,10867.54,10867.54,10867.54,10000.00,10000.00,10000.00,10867.54,10469.00,10469.00,10867.54,10000.00,10000.00,9686.88,9686.88,10469.00,9686.88,10469.00,10469.00,10469.00,10000.00,10867.54,10469.00,10469.00,10469.00,9341.37,10867.54])
#f3 = np.array([10000.00,10469.00,10469.00,10000.00,10469.00,9686.88,10469.00,10000.00,10867.54,10469.00,10469.00,10469.00,10469.00,9686.88,10265.70,10000.00,10000.00,9003.62,10867.54,9686.88,9341.37,9686.88,10867.54,10000.00,10867.54,10469.00,10469.00,11884.32,10469.00,9686.88,10867.54,9686.88,10000.00,10000.00,10000.00,10867.54,10469.00,9686.88,10000.00,9686.88])
#f4 = np.array([10469.00,10867.54,10000.00,10469.00,10867.54,9686.88,9686.88,10000.00,10867.54,10469.00,10867.54,10000.00,10867.54,10000.00,10469.00,9686.88,9686.88,10867.54,10867.54,10000.00,10000.00,10000.00,10000.00,10867.54,10469.00,9686.88,10867.54,10469.00,10000.00,10000.00,10867.54,10469.00,10000.00,10000.00,9686.88,10867.54,10867.54,10867.54,10469.00,10469.00])

#f1 = np.array([11368.61,10469.00,10867.54,10469.00,10000.00,10000.00,10867.54,10867.54,10000.00,10867.54,10469.00,9686.88,9686.88,10867.54,10000.00,9686.88,9686.88,10469.00,10469.00,10867.54,9686.88,10469.00,10867.54,10867.54,10867.54,10000.00,10469.00,10469.00,9686.88,9686.88,10867.54,10469.00,9686.88,9686.88,9686.88,10469.00,10000.00,10469.00,10867.54,10000.00])
#f2 = np.array([10867.54,10867.54,10867.54,10867.54,10867.54,10867.54,10867.54,10469.00,10000.00,10000.00,10867.54,10469.00,9686.88,10469.00,10867.54,10469.00,10469.00,10000.00,10867.54,10000.00,10469.00,10867.54,10867.54,9686.88,10867.54,10000.00,10867.54,10469.00,10867.54,10000.00,10000.00,10000.00,10000.00,10469.00,10469.00,10000.00,10000.00,9686.88,10469.00,10867.54])
#f3 = np.array([10000.00,10469.00,10867.54,9686.88,10000.00,10469.00,10000.00,10867.54,10000.00,10000.00,9686.88,10867.54,9686.88,10469.00,10000.00,10000.00,10000.00,10469.00,10000.00,10867.54,9253.38,10469.00,10469.00,9686.88,10265.70,9686.88,9686.88,10469.00,10000.00,9686.88,10469.00,9686.88,10867.54,10000.00,10469.00,10000.00,10469.00,10867.54,10867.54,10469.00])
#f4 = np.array([10867.54,10867.54,10469.00,10867.54,10000.00,10000.00,11884.32,10867.54,9686.88,10000.00,10867.54,9686.88,9686.88,10469.00,10469.00,10469.00,10000.00,9686.88,10469.00,9686.88,10000.00,10000.00,10000.00,10469.00,10000.00,10000.00,9686.88,10000.00,9686.88,9686.88,10469.00,10000.00,10469.00,9686.88,10000.00,10867.54,9686.88,10469.00,10469.00,9686.88])

#f1 = np.array([10000.00,10867.54,10000.00,9686.88,10469.00,10867.54,10469.00,10469.00,10867.54,10867.54,10469.00,10000.00,10000.00,9686.88,10469.00,10000.00,9686.88,10000.00,10867.54,10867.54,9253.38,10000.00,10000.00,10469.00,9686.88,10469.00,10469.00,10469.00,9686.88,9253.38,9686.88,10000.00,9686.88,9686.88,9686.88,10469.00,10867.54,10867.54,10867.54,10867.54])
#f2 = np.array([10469.00,10469.00,10867.54,9686.88,10000.00,10000.00,10000.00,10469.00,9686.88,9686.88,10000.00,10000.00,10867.54,10000.00,10867.54,10867.54,9686.88,10000.00,10867.54,10000.00,10000.00,10000.00,10867.54,9686.88,10469.00,9686.88,10000.00,9686.88,10469.00,9686.88,10867.54,10000.00,10867.54,9686.88,10469.00,10000.00,10000.00,10000.00,10867.54,9686.88])
#f3 = np.array([10469.00,10867.54,11368.61,10469.00,10469.00,10867.54,10000.00,10469.00,10469.00,10469.00,9253.38,9253.38,10000.00,10469.00,11884.32,10469.00,10469.00,10000.00,10469.00,10469.00,9686.88,10000.00,10867.54,9253.38,10469.00,10000.00,10867.54,10469.00,10469.00,10867.54,10867.54,10469.00,10000.00,9686.88,9686.88,10000.00,9253.38,10000.00,9686.88,10867.54])
#f4 = np.array([10867.54,10867.54,10867.54,10867.54,9686.88,9686.88,9686.88,10469.00,10000.00,10469.00,10000.00,10000.00,10867.54,10867.54,10469.00,9686.88,10000.00,9686.88,10469.00,10469.00,10000.00,9686.88,10000.00,10867.54,10000.00,10000.00,10469.00,10469.00,9686.88,9253.38,10867.54,10469.00,9686.88,9686.88,10469.00,10469.00,9686.88,10000.00,9686.88,9686.88])

#500 ohm calibration
#f0=np.array([500.00,481.92,466.96,450.96,480.50,500.00,466.96,480.50,466.96,450.96,500.00,450.96,480.50,500.00,537.22,466.96,466.96,450.96,500.00,424.32,480.50,450.96,466.96,424.32,466.96,500.00,466.96,466.96,450.96,500.00,500.00,437.57,500.00,500.00,466.96,424.32,466.96,500.00,450.96,537.22])
#f1=np.array([450.96,450.96,537.22,500.00,500.00,424.32,466.96,437.57,450.96,450.96,450.96,466.96,537.22,481.92,466.96,500.00,466.96,466.96,466.96,437.57,500.00,500.00,518.49,450.96,480.50,500.00,450.96,466.96,480.50,500.00,537.22,500.00,500.00,466.96,500.00,450.96,480.50,480.50,500.00,480.50])
#f2=np.array([500.00,480.50,466.96,424.32,466.96,466.96,450.96,424.32,450.96,400.25,424.32,434.40,437.57,424.32,500.00,424.32,466.96,424.32,466.96,424.32,466.96,400.25,466.96,400.25,424.32,466.96,500.00,424.32,424.32,466.96,437.57,437.57,466.96,500.00,500.00,411.32,400.25,437.57,450.96,424.32])
#f3=np.array([466.96,450.96,437.57,424.32,481.92,466.96,466.96,400.25,500.00,450.96,437.57,450.96,437.57,437.57,500.00,424.32,450.96,450.96,513.25,410.43,450.96,450.96,500.00,387.79,424.32,450.96,437.57,400.25,424.32,450.96,450.96,437.57,466.96,466.96,466.96,450.96,466.96,424.32,518.49,400.25])
#f4=np.array([450.96,480.50,466.96,466.96,437.57,400.25,437.57,400.25,450.96,424.32,466.96,450.96,500.00,400.25,560.36,450.96,500.00,424.32,500.00,437.57,450.96,437.57,500.00,400.25,437.57,450.96,424.32,424.32,480.50,480.50,424.32,424.32,450.96,466.96,513.25,424.32,424.32,437.57,450.96,424.32])

#f0=np.array([500.00,434.40,500.00,450.96,424.32,424.32,424.32,424.32,437.57,410.43,450.96,424.32,480.50,424.32,466.96,424.32,480.50,424.32,466.96,400.25,450.96,424.32,466.96,400.25,437.57,450.96,424.32,378.48,400.25,411.32,466.96,400.25,400.25,500.00,437.57,424.32,424.32,424.32,450.96,424.32])
#f1=np.array([518.49,518.49,500.00,466.96,560.36,518.49,500.00,466.96,500.00,518.49,466.96,466.96,518.49,518.49,500.00,500.00,450.96,500.00,518.49,466.96,500.00,537.22,518.49,500.00,466.96,500.00,518.49,466.96,518.49,560.36,480.50,500.00,518.49,537.22,500.00,518.49,537.22,500.00,560.36,500.00])
#f2=np.array([537.22,537.22,500.00,481.92,500.00,537.22,537.22,518.49,500.00,500.00,500.00,560.36,500.00,500.00,500.00,513.25,481.92,500.00,537.22,518.49,500.00,537.22,518.49,500.00,500.00,537.22,518.49,500.00,518.49,518.49,500.00,518.49,466.96,500.00,500.00,481.92,500.00,500.00,500.00,500.00])
#f3=np.array([518.49,518.49,560.36,560.36,500.00,560.36,500.00,518.49,500.00,560.36,537.22,518.49,518.49,500.00,500.00,537.22,466.96,518.49,518.49,500.00,500.00,537.22,500.00,500.00,500.00,518.49,500.00,518.49,537.22,466.96,500.00,537.22,560.36,500.00,500.00,518.49,500.00,518.49,560.36,500.00])
#f4=np.array([500.00,560.36,481.92,500.00,500.00,560.36,537.22,537.22,560.36,537.22,481.92,560.36,518.49,518.49,560.36,518.49,537.22,500.00,518.49,466.96,500.00,500.00,537.22,560.36,500.00,500.00,518.49,537.22,560.36,500.00,500.00,560.36,500.00,518.49,500.00,500.00,537.22,500.00,500.00,537.22])

#10k calibration --> first time obtaining values different than calibration....
#f0=np.array([18998.60,21101.08,20440.36,18408.94,20440.36,20440.36,20440.36,19711.29,20440.36,20440.36,18998.60,18998.60,18998.60,18408.94,18998.60,19711.29,18998.60,19711.29,20440.36,20440.36,17732.26,20440.36,18998.60,20440.36,20440.36,18408.94,20440.36,18998.60,18998.60,18998.60,20440.36,18998.60,19711.29,18408.94,18408.94,22090.72,20440.36,19711.29,20440.36,18408.94])
#f1=np.array([20440.36,19711.29,20440.36,18998.60,21101.08,18408.94,18408.94,18408.94,20440.36,20440.36,18998.60,19711.29,18408.94,18408.94,22090.72,20440.36,19711.29,20440.36,18998.60,20440.36,18998.60,20440.36,21101.08,20440.36,20440.36,20440.36,22090.72,20440.36,19525.62,18998.60,21101.08,20440.36,20440.36,19711.29,19711.29,20440.36,20440.36,20440.36,20440.36,18408.94])
#f2=np.array([20440.36,19525.62,20440.36,18998.60,18998.60,18998.60,20440.36,20440.36,18998.60,20440.36,20440.36,18408.94,18408.94,19525.62,21101.08,19711.29,18998.60,19711.29,19525.62,18408.94,20440.36,19711.29,20440.36,18998.60,20440.36,19711.29,19711.29,20440.36,20440.36,18998.60,20440.36,19711.29,20440.36,18998.60,19711.29,18998.60,19711.29,18408.94,18998.60,19525.62])
#f3=np.array([18998.60,20440.36,20440.36,22090.72,18998.60,18998.60,18998.60,20440.36,19711.29,19711.29,20440.36,18998.60,19711.29,20440.36,20440.36,20440.36,20440.36,18998.60,20440.36,18408.94,19711.29,18998.60,22090.72,18998.60,20440.36,19711.29,21101.08,20440.36,20440.36,20440.36,19525.62,19711.29,18408.94,18408.94,19711.29,21178.51,20440.36,20440.36,18998.60,20440.36])
#f4=np.array([22090.72,20440.36,20440.36,19711.29,19711.29,19711.29,18408.94,20440.36,19711.29,20440.36,20440.36,18998.60,20440.36,20440.36,20440.36,18998.60,18408.94,19711.29,20440.36,20440.36,19711.29,18998.60,21101.08,20440.36,20440.36,20440.36,20440.36,20440.36,20440.36,20440.36,22090.72,18408.94,20440.36,18408.94,18408.94,18998.60,21101.08,20440.36,18998.60,18408.94])


#f0=np.array([8913.59,8027.73,9201.71,8595.66,8284.87,8027.73,8913.59,8595.66,8027.73,8595.66,8913.59,8595.66,7522.32,8284.87,8284.87,8027.73,8595.66,8027.73,8027.73,8595.66,7732.65,8913.59,8595.66,8913.59,8913.59,8595.66,8913.59,8595.66,8027.73,8027.73,8595.66,8027.73,8284.87,8913.59,7732.65,8284.87,8284.87,7522.32,8514.69,8027.73])
#f1=np.array([8595.66,8284.87,8913.59,8595.66,8913.59,8027.73,8027.73,8913.59,8913.59,8913.59,8595.66,8514.69,8595.66,8913.59,8913.59,8514.69,8595.66,8595.66,8595.66,8913.59,7732.65,8913.59,8913.59,8595.66,8595.66,8027.73,8284.87,8284.87,8027.73,9633.28,8913.59,8027.73,8284.87,8595.66,8027.73,8595.66,8913.59,8284.87,9201.71,8595.66])
#f2=np.array([8913.59,8913.59,9235.48,8027.73,8595.66,8595.66,8595.66,8284.87,8027.73,8027.73,8913.59,8913.59,8595.66,8595.66,8913.59,8027.73,7732.65,8027.73,8595.66,7522.32,7522.32,7522.32,8913.59,8027.73,7522.32,8284.87,8913.59,7522.32,7522.32,7071.07,8284.87,8027.73,8595.66,7522.32,8027.73,8595.66,8284.87,8027.73,8595.66,7522.32])
#f3=np.array([8913.59,8027.73,9201.71,8027.73,8913.59,8027.73,8913.59,8027.73,8027.73,8595.66,7522.32,8027.73,8595.66,8595.66,8284.87,7522.32,8027.73,8595.66,7732.65,7522.32,8284.87,7522.32,8027.73,7294.59,8027.73,7522.32,8284.87,7071.07,7071.07,8027.73,8913.59,8595.66,7522.32,7732.65,7732.65,7522.32,6880.91,7752.65,7522.32,7752.65])
#f4=np.array([8027.73,8284.87,8913.59,9235.48,8027.73,8913.59,7522.32,8595.66,7522.32,8913.59,8027.73,8027.73,8027.73,8284.87,8913.59,8284.87,8595.66,8027.73,8595.66,8027.73,7732.65,8284.87,8913.59,8027.73,8284.87,8595.66,8913.59,7071.07,7522.32,8027.73,8913.59,8595.66,8027.73,8284.87,8027.73,8027.73,8595.66,7522.32,8913.59,7522.32])

#evidenziatore adjacent
#f0=np.array([10686.50,10982.94,11087.38,12425.78,11869.12,10354.82,11497.47,11087.38,10354.82,11497.47,11497.47,10354.82,10686.50,12425.78,11087.38,11087.38,10686.50,11497.47,11497.47,11497.47,11087.38,11869.12,11497.47,12425.78,11497.47,11497.47,11912.67,11497.47,11497.47,11087.38,10354.82,11087.38,10686.50,10686.50,10686.50,11497.47,11497.47,11087.38,10354.82,11087.38])
#f1=np.array([12425.78,11497.47,11497.47,10686.50,11087.38,11497.47,11087.38,11497.47,11497.47,11087.38,11087.38,11497.47,10982.94,11497.47,11869.12,10686.50,11497.47,11497.47,10982.94,10686.50,10354.82,10686.50,12425.78,10354.82,11497.47,11087.38,11869.12,10686.50,11087.38,10354.82,11869.12,11497.47,11087.38,10686.50,11497.47,10686.50,11497.47,11087.38,12425.78,12425.78])
#f2=np.array([11087.38,11087.38,11497.47,10686.50,10686.50,11087.38,11497.47,11497.47,11497.47,11497.47,11869.12,11497.47,10354.82,11497.47,11869.12,11497.47,10354.82,11087.38,11497.47,11087.38,10686.50,11869.12,11497.47,11497.47,11869.12,11497.47,11497.47,10686.50,10354.82,10686.50,10686.50,11497.47,9974.19,11087.38,10686.50,11497.47,10982.94,11912.67,11497.47,11087.38])
#f3=np.array([12425.78,10686.50,10686.50,10686.50,10686.50,11497.47,10686.50,11087.38,12425.78,10354.82,11087.38,10686.50,11087.38,11497.47,12898.81,11497.47,10686.50,11497.47,10686.50,11497.47,11497.47,11497.47,12425.78,11497.47,11497.47,11087.38,11497.47,10686.50,11497.47,10686.50,11497.47,10686.50,11869.12,10354.82,10982.94,11497.47,11087.38,11087.38,10686.50,11869.12])
#f4=np.array([10686.50,11087.38,11497.47,10354.82,11497.47,11087.38,12425.78,11497.47,11087.38,11497.47,11497.47,10354.82,11087.38,11497.47,11497.47,11497.47,10354.82,11497.47,11497.47,10686.50,11087.38,11087.38,12425.78,11497.47,10686.50,11087.38,11497.47,11087.38,10982.94,11497.47,12425.78,11087.38,11087.38,11087.38,11497.47,10686.50,11497.47,11497.47,11087.38,11497.47])

#evidenziatore opposite
#f0=np.array([11497.47,11497.47,11497.47,11497.47,11497.47,10686.50,11087.38,11497.47,11497.47,11497.47,11497.47,11497.47,10354.82,11087.38,10686.50,10354.82,11497.47,10686.50,12425.78,12425.78,10686.50,11087.38,12425.78,12898.81,10686.50,11497.47,11497.47,11087.38,11087.38,10354.82,9702.90,10354.82])
#f1=np.array([11497.47,12425.78,11497.47,11497.47,11869.12,10686.50,11497.47,11087.38,11497.47,11497.47,11087.38,10686.50,11087.38,11087.38,11497.47,11497.47,11497.47,11497.47,11497.47,11869.12,10354.82,11087.38,11497.47,11497.47,11497.47,11869.12,10686.50,10354.82,11087.38,11497.47,10354.82,9974.19])
#f2=np.array([10982.94,11497.47,11497.47,11869.12,10686.50,11497.47,11497.47,11869.12,10686.50,11497.47,12425.78,11087.38,11497.47,10686.50,11087.38,11912.67,11497.47,11497.47,11497.47,11497.47,11087.38,11497.47,11497.47,11087.38,11497.47,11497.47,11497.47,11912.67,11497.47,10686.50,10354.82,10354.82])
#f3=np.array([11497.47,11497.47,11497.47,11497.47,10686.50,10354.82,11497.47,11497.47,11869.12,11869.12,12425.78,12425.78,10686.50,10686.50,10354.82,10354.82,11497.47,11497.47,11497.47,11087.38,10354.82,11087.38,11497.47,11087.38,11869.12,11497.47,10686.50,12425.78,11497.47,10686.50,10686.50,10354.82])
#f4=np.array([12425.78,11497.47,11087.38,11497.47,11497.47,11087.38,10686.50,11497.47,11912.67,12425.78,12425.78,10686.50,12425.78,10686.50,11497.47,10686.50,11497.47,11912.67,11497.47,10686.50,10354.82,12843.57,11497.47,11087.38,11497.47,12425.78,10686.50,10354.82,11497.47,10686.50,11497.47,9974.19])

#pennarello opposite
#f0=np.array([11869.12,12425.78,11497.47,11497.47,10686.50,11497.47,10686.50,11497.47,10686.50,11087.38,11497.47,11497.47,11497.47,11087.38,11869.12,11497.47,11497.47,11869.12,11497.47,11497.47,11087.38,11497.47,11087.38,10686.50,12425.78,11497.47,12425.78,11087.38,11497.47,11497.47,10686.50,9702.90])
#f1=np.array([11497.47,11497.47,10686.50,11869.12,10982.94,11497.47,10686.50,11497.47,10686.50,11869.12,12425.78,11497.47,11087.38,10354.82,11087.38,11087.38,10686.50,12898.81,11497.47,11497.47,11497.47,11087.38,10354.82,10686.50,11497.47,12425.78,11087.38,11497.47,10686.50,10982.94,10686.50,10354.82])
#f2=np.array([11497.47,11497.47,11497.47,12425.78,11497.47,11497.47,11497.47,11497.47,11497.47,10686.50,12898.81,11087.38,11869.12,10354.82,11869.12,11497.47,11497.47,10982.94,11497.47,11497.47,10982.94,10354.82,11497.47,11497.47,10982.94,12425.78,11087.38,11087.38,10354.82,10686.50,10686.50,10354.82])
#f3=np.array([10982.94,12425.78,10686.50,11087.38,11497.47,10686.50,11087.38,12425.78,10686.50,10982.94,11869.12,12425.78,11087.38,10686.50,11497.47,11497.47,10686.50,11087.38,11869.12,11497.47,10354.82,11497.47,10686.50,11087.38,11497.47,11869.12,12425.78,11497.47,11497.47,10686.50,11087.38,10354.82])
#f4=np.array([11912.67,11869.12,10982.94,11497.47,10686.50,11869.12,11869.12,11869.12,11912.67,10686.50,12425.78,11497.47,11087.38,10000.00,11497.47,11087.38,10686.50,11087.38,11497.47,11869.12,11912.67,11087.38,11497.47,11497.47,11497.47,12425.78,11087.38,11497.47,10354.82,11497.47,10354.82,10354.82])

#evidenziatore adj
f0=np.array([11869.12,11497.47,11497.47,11087.38,11087.38,11087.38,11087.38,11087.38,11497.47,11497.47,11497.47,10354.82,11497.47,10982.94,11497.47,11087.38,11497.47,11497.47,11497.47,11087.38,11497.47,11497.47,12425.78,11087.38,10686.50,11087.38,11497.47,10686.50,10686.50,11497.47,10686.50,11497.47,11087.38,10354.82,11497.47,11497.47,11497.47,11497.47,11497.47,11087.38])
#f1=np.array([11497.47,11087.38,11869.12,11497.47,11497.47,11497.47,11497.47,11497.47,10686.50,11497.47,11087.38,11912.67,11087.38,11087.38,10686.50,11497.47,11497.47,10686.50,11087.38,11869.12,10354.82,11497.47,11497.47,10686.50,11497.47,10354.82,11497.47,11497.47,11497.47,11087.38,11497.47,11087.38,11497.47,10686.50,11497.47,11497.47,11497.47,10686.50,10354.82,10686.50])
#f2=np.array([11497.47,11087.38,11497.47,11087.38,11087.38,11497.47,11912.67,11087.38,11497.47,10686.50,11497.47,11087.38,9974.19,11497.47,11497.47,11087.38,11087.38,10686.50,12425.78,11497.47,11869.12,11497.47,11497.47,11497.47,11497.47,10686.50,10686.50,11087.38,10686.50,10686.50,10354.82,11497.47,11087.38,10354.82,10686.50,11497.47,10686.50,11087.38,11497.47,11497.47])
#f3=np.array([12425.78,12425.78,11497.47,10354.82,11497.47,10686.50,11497.47,11087.38,12425.78,11497.47,11497.47,11087.38,11497.47,11869.12,12425.78,10686.50,11497.47,11497.47,11497.47,11497.47,10686.50,11087.38,11497.47,11497.47,10686.50,11869.12,12898.81,11912.67,10354.82,11497.47,11497.47,11497.47,11497.47,10354.82,10686.50,11497.47,11497.47,11497.47,11497.47,10686.50])
#f4=np.array([11869.12,12425.78,10686.50,11497.47,11497.47,10686.50,11497.47,11497.47,11497.47,11497.47,11497.47,10686.50,10686.50,11497.47,11497.47,10686.50,11497.47,11497.47,11497.47,11497.47,11497.47,11087.38,11869.12,11497.47,10686.50,11087.38,11497.47,11087.38,11497.47,11087.38,11497.47,11497.47,11497.47,11497.47,9974.19,11087.38,11497.47,11087.38,11497.47,10686.50])

#evidenziatore+pennarello
#f1=np.array([11869.12,11497.47,11497.47,11497.47,11497.47,11497.47,11497.47,11497.47,11497.47,11497.47,11497.47,11497.47,10686.50,11497.47,11497.47,11087.38,11497.47,10686.50,11497.47,11087.38,11912.67,11869.12,11869.12,11497.47,11497.47,11869.12,12425.78,11497.47,10686.50,11497.47,10686.50,11497.47,10686.50,12425.78,10354.82,10686.50,11087.38,11497.47,11087.38,11087.38])
#f2=np.array([11497.47,11869.12,12425.78,11087.38,12425.78,12425.78,11497.47,10354.82,11497.47,11497.47,12425.78,10686.50,11497.47,11497.47,11087.38,11497.47,11497.47,11497.47,12425.78,11497.47,12425.78,12425.78,11497.47,11087.38,11497.47,10686.50,12425.78,11869.12,11497.47,11497.47,11497.47,11087.38,10686.50,10354.82,10354.82,10686.50,11497.47,11497.47,11497.47,11087.38])
#f3=np.array([11869.12,12425.78,12425.78,11497.47,11087.38,11087.38,10982.94,11497.47,11087.38,11497.47,10982.94,11869.12,11497.47,11497.47,11497.47,11087.38,11497.47,11497.47,11497.47,11497.47,11497.47,11869.12,10686.50,11912.67,11497.47,12425.78,11497.47,11497.47,11912.67,11497.47,11497.47,11497.47,10686.50,11497.47,12425.78,11087.38,11087.38,12425.78,12425.78,11912.67])
#f4=np.array([12425.78,11497.47,11869.12,11497.47,12425.78,11497.47,11087.38,12425.78,10686.50,12425.78,11497.47,11497.47,11497.47,11087.38,11497.47,11497.47,11087.38,10686.50,12425.78,11497.47,10982.94,11497.47,10982.94,11869.12,11869.12,11497.47,11497.47,11087.38,12425.78,11497.47,12425.78,11497.47,11497.47,11497.47,11497.47,11497.47,11912.67,10686.50,10982.94,11497.47])

#pennarello adj
#f1=np.array([11497.47,11087.38,12425.78,11497.47,11087.38,10354.82,12425.78,11497.47,11497.47,12425.78,12425.78,11497.47,11497.47,10354.82,11497.47,10354.82,10354.82,11497.47,10686.50,10982.94,11497.47,10686.50,11497.47,11869.12,12425.78,10686.50,11497.47,11497.47,11497.47,11497.47,11869.12,10686.50,10686.50,11087.38,10686.50,10686.50,10686.50,10686.50,11497.47,11869.12])
#f2=np.array([12898.81,11869.12,11497.47,10686.50,11497.47,12425.78,11497.47,11497.47,11087.38,11497.47,11497.47,11497.47,11497.47,11497.47,12425.78,11497.47,10686.50,11497.47,11869.12,11087.38,12425.78,12425.78,12425.78,12425.78,11497.47,11497.47,11497.47,11497.47,11497.47,11497.47,11497.47,10982.94,10982.94,10686.50,11087.38,10982.94,11087.38,12425.78,11497.47,11497.47])
#f3=np.array([12425.78,11087.38,11497.47,11497.47,12425.78,11497.47,11497.47,10354.82,10354.82,11869.12,11087.38,11912.67,11087.38,11497.47,11497.47,11497.47,10686.50,11497.47,11497.47,11497.47,11087.38,11087.38,11497.47,11497.47,10982.94,11497.47,11497.47,11497.47,11497.47,11087.38,11497.47,11497.47,11497.47,10686.50,10354.82,11497.47,12425.78,10686.50,11497.47,11497.47])
#f4=np.array([11497.47,10686.50,12425.78,11497.47,11497.47,12425.78,11869.12,11912.67,11497.47,10354.82,11497.47,10686.50,11869.12,11497.47,11087.38,11087.38,11869.12,10354.82,12425.78,10982.94,10686.50,11912.67,11497.47,11497.47,11497.47,11087.38,11497.47,11497.47,11497.47,10354.82,11869.12,11497.47,10686.50,11497.47,11087.38,10982.94,11497.47,11497.47,11869.12,11497.47])


#pennarello opp
#f0=np.array([12425.78,11869.12,11869.12,11497.47,11497.47,11869.12,11497.47,11497.47,11087.38,11497.47,11869.12,11869.12,11497.47,10982.94,11497.47,11497.47,10686.50,12425.78,10686.50,10686.50,10686.50,11497.47,10686.50,12425.78,10686.50,12898.81,10686.50,11087.38,11087.38,11087.38,12425.78,11497.47])
#f1=np.array([11497.47,11087.38,11497.47,12425.78,12425.78,10686.50,10686.50,11087.38,11869.12,11497.47,11869.12,10686.50,12425.78,11497.47,11497.47,11497.47,11087.38,11087.38,12425.78,10686.50,10686.50,11869.12,10686.50,11497.47,10354.82,11869.12,10686.50,11497.47,11497.47,10686.50,11087.38,11087.38])
#f2=np.array([11497.47,11497.47,11497.47,11497.47,11497.47,11497.47,11497.47,11869.12,11087.38,11497.47,12425.78,10982.94,11497.47,9974.19,10686.50,10982.94,11497.47,11497.47,11497.47,11912.67,11497.47,11087.38,10686.50,10686.50,12425.78,11497.47,11087.38,10686.50,11497.47,11497.47,11497.47,11497.47])
#f3=np.array([11869.12,11869.12,11912.67,12425.78,10686.50,11912.67,11497.47,12425.78,11912.67,11497.47,12898.81,10686.50,11497.47,10686.50,11087.38,11497.47,11497.47,12425.78,13493.53,11497.47,10686.50,12425.78,11087.38,11497.47,11869.12,11497.47,11087.38,11912.67,11087.38,11912.67,11497.47,11087.38])
#f4=np.array([11869.12,11869.12,11497.47,10686.50,11497.47,11497.47,11087.38,12425.78,11497.47,11087.38,12425.78,11497.47,11497.47,10686.50,11912.67,11869.12,11912.67,11497.47,12425.78,11087.38,10354.82,11869.12,10686.50,11912.67,11497.47,12425.78,11912.67,10686.50,11497.47,11497.47,11087.38,10686.50])

#saline adjacent
f0=np.array([575.36,567.39,575.36,601.46,550.00,550.00,601.46,601.46,550.00,601.46,601.46,550.00,550.00,601.46,601.46,550.00,601.46,550.00,550.00,550.00,506.09,550.00,601.46,550.00,601.46,550.00,550.00,529.83,601.46,550.00,550.00,550.00,550.00,506.09,550.00,550.00,550.00,601.46,550.00,550.00])
f1=np.array([601.46,550.00,550.00,550.00,550.00,601.46,550.00,550.00,550.00,550.00,601.46,550.00,550.00,601.46,601.46,490.25,550.00,506.09,550.00,550.00,550.00,550.00,550.00,550.00,550.00,601.46,601.46,550.00,601.46,550.00,601.46,529.83,506.09,550.00,550.00,601.46,550.00,550.00,601.46,529.83])
f2=np.array([601.46,490.25,601.46,550.00,624.41,550.00,550.00,550.00,550.00,550.00,550.00,601.46,567.39,550.00,601.46,601.46,550.00,575.36,601.46,601.46,567.39,567.39,601.46,567.39,550.00,550.00,601.46,550.00,601.46,550.00,575.36,601.46,550.00,550.00,550.00,550.00,550.00,550.00,550.00,550.00])
f3=np.array([529.83,550.00,567.39,601.46,575.36,601.46,550.00,550.00,601.46,601.46,550.00,550.00,601.46,550.00,550.00,550.00,601.46,601.46,529.83,550.00,550.00,550.00,601.46,529.83,601.46,601.46,601.46,550.00,550.00,550.00,550.00,550.00,601.46,550.00,550.00,550.00,601.46,529.83,550.00,550.00])
f4=np.array([601.46,601.46,601.46,575.36,601.46,550.00,550.00,575.36,550.00,601.46,550.00,550.00,550.00,601.46,550.00,550.00,550.00,601.46,601.46,550.00,550.00,601.46,601.46,575.36,550.00,550.00,601.46,601.46,529.83,601.46,601.46,601.46,529.83,550.00,550.00,550.00,550.00,550.00,529.83,550.00])

#saline opposite
f0=np.array([550.00,601.46,601.46,601.46,550.00,550.00,601.46,601.46,550.00,550.00,601.46,601.46,601.46,506.09,550.00,550.00,601.46,550.00,550.00,550.00,550.00,550.00,550.00,550.00,550.00,601.46,550.00,601.46,550.00,550.00,550.00,550.00])
f1=np.array([601.46,550.00,601.46,601.46,575.36,550.00,550.00,506.09,601.46,550.00,601.46,529.83,490.25,550.00,550.00,601.46,550.00,550.00,601.46,601.46,550.00,601.46,550.00,550.00,550.00,601.46,550.00,550.00,550.00,529.83,529.83,506.09])
f2=np.array([550.00,601.46,550.00,601.46,601.46,550.00,601.46,529.83,601.46,550.00,624.41,575.36,550.00,506.09,550.00,550.00,550.00,550.00,550.00,601.46,550.00,550.00,550.00,550.00,550.00,601.46,550.00,550.00,601.46,550.00,550.00,529.83])
f3=np.array([601.46,550.00,529.83,550.00,550.00,601.46,550.00,550.00,550.00,550.00,550.00,550.00,506.09,550.00,550.00,550.00,601.46,550.00,601.46,550.00,550.00,624.41,550.00,550.00,601.46,601.46,550.00,550.00,601.46,550.00,529.83,550.00])
f4=np.array([601.46,550.00,550.00,601.46,601.46,601.46,550.00,550.00,550.00,601.46,601.46,550.00,601.46,550.00,601.46,550.00,550.00,575.36,601.46,550.00,550.00,550.00,550.00,601.46,567.39,550.00,550.00,601.46,550.00,550.00,529.83,506.09])

#senza niente
f0=np.array([388.91,441.53,413.73,425.30,425.30,413.73,413.73,388.91,378.45,425.30,413.73,413.73,388.91,413.73,441.53,388.91,378.45,413.73,413.73,413.73,425.30,398.47,413.73,413.73,413.73,388.91,413.73,388.91,388.91,388.91,401.20,374.65,378.45,401.20,378.45,378.45,388.91,441.53,413.73,388.91])
f1=np.array([398.47,441.53,425.30,413.73,413.73,413.73,441.53,413.73,425.30,413.73,388.91,388.91,388.91,413.73,441.53,413.73,388.91,413.73,388.91,425.30,413.73,388.91,455.67,441.53,425.30,413.73,441.53,413.73,413.73,388.91,441.53,455.67,413.73,425.30,388.91,425.30,455.67,441.53,413.73,401.20])
f2=np.array([425.30,413.73,441.53,441.53,441.53,455.67,441.53,413.73,425.30,388.91,413.73,425.30,425.30,441.53,441.53,388.91,366.67,413.73,413.73,413.73,425.30,425.30,455.67,413.73,425.30,413.73,398.47,398.47,388.91,401.20,413.73,388.91,388.91,388.91,378.45,378.45,413.73,401.20,455.67,413.73])
f3=np.array([425.30,398.47,425.30,413.73,441.53,413.73,441.53,441.53,401.20,398.47,413.73,259.77,357.86,357.86,413.73,388.91,398.47,388.91,425.30,490.25,388.91,388.91,435.52,388.91,441.53,413.73,413.73,378.45,388.91,425.30,378.45,441.53,401.20,413.73,388.91,413.73,401.20,388.91,388.91,388.91])
f4=np.array([378.45,398.47,413.73,378.45,401.20,378.45,378.45,378.45,388.91,550.00,212.65,519.54,567.39,478.90,444.00,357.86,357.86,378.45,388.91,601.46,398.47,378.45,366.67,366.67,357.86,388.91,388.91,388.91,378.45,601.46,388.91,366.67,346.66,357.86,357.86,366.67,401.20,413.73,398.47,624.41])


f0=np.array([565.38,672.79,605.75,622.56,622.56,605.75,605.75,651.72,605.75,651.72,605.75,651.72,651.72,651.72,605.75,605.75,672.79,578.97,605.75,586.95,605.75,605.75,605.75,565.38,605.75,651.72,605.75,605.75,605.75,651.72,651.72,565.38,586.95,651.72,651.72,605.75,605.75,605.75,605.75,605.75])
f1=np.array([605.75,586.95,651.72,605.75,605.75,586.95,605.75,565.38,622.56,605.75,605.75,407.74,605.75,605.75,622.56,628.48,605.75,586.95,586.95,550.00,605.75,550.00,605.75,586.95,550.00,651.72,605.75,605.75,586.95,605.75,605.75,605.75,605.75,605.75,651.72,605.75,605.75,628.48,605.75,605.75])
f2=np.array([550.00,517.01,565.38,487.44,487.44,487.44,517.01,487.44,475.73,450.91,450.91,450.91,450.91,487.44,565.38,651.72,605.75,605.75,605.75,605.75,651.72,672.79,622.56,605.75,605.75,605.75,628.48,605.75,622.56,622.56,651.72,651.72,605.75,605.75,622.56,586.95,651.72,605.75,622.56,651.72])
f3=np.array([565.38,517.01,550.00,487.44,651.72,605.75,651.72,651.72,622.56,605.75,605.75,586.95,605.75,651.72,622.56,651.72,605.75,605.75,605.75,605.75,651.72,651.72,605.75,622.56,605.75,651.72,651.72,605.75,651.72,605.75,622.56,605.75,605.75,605.75,605.75,651.72,605.75,622.56,605.75,622.56])
f4=np.array([622.56,651.72,651.72,605.75,622.56,651.72,651.72,628.48,651.72,605.75,605.75,503.10,622.56,622.56,704.34,651.72,651.72,586.95,605.75,605.75,622.56,605.75,605.75,605.75,605.75,605.75,651.72,605.75,628.48,622.56,605.75,651.72,651.72,622.56,605.75,605.75,605.75,605.75,651.72,651.72])


#baseline opp  no pennarello
f0=np.array([651.72,605.75,651.72,586.95,550.00,586.95,586.95,586.95,628.48,628.48,605.75,586.95,605.75,605.75,550.00,764.87,628.48,605.75,628.48,605.75,586.95,651.72,586.95,586.95,605.75,605.75,586.95,628.48,550.00,586.95,586.95,628.48])
f1=np.array([605.75,628.48,651.72,651.72,605.75,605.75,586.95,628.48,605.75,586.95,605.75,605.75,586.95,628.48,586.95,704.34,628.48,586.95,651.72,605.75,605.75,605.75,517.01,586.95,605.75,605.75,628.48,605.75,550.00,605.75,586.95,628.48])
f2=np.array([586.95,605.75,586.95,605.75,550.00,586.95,605.75,628.48,628.48,605.75,704.34,651.72,605.75,605.75,605.75,651.72,605.75,651.72,605.75,586.95,605.75,586.95,628.48,586.95,605.75,605.75,605.75,605.75,605.75,586.95,586.95,605.75])
f3=np.array([586.95,605.75,651.72,605.75,586.95,586.95,651.72,628.48,628.48,651.72,628.48,605.75,651.72,565.38,566.84,731.16,565.38,586.95,586.95,605.75,651.72,550.00,550.00,586.95,605.75,628.48,550.00,651.72,605.75,533.35,586.95,603.97])
f4=np.array([628.48,586.95,605.75,586.95,565.38,628.48,605.75,605.75,628.48,651.72,628.48,550.00,651.72,628.48,605.75,704.34,651.72,605.75,605.75,605.75,628.48,605.75,517.01,550.00,605.75,605.75,651.72,605.75,605.75,605.75,628.48,586.95])

#baseline adj no pennarello calibrazione=1k
#f0=np.array([920.87,951.83,920.87,951.83,951.83,882.84,852.07,920.87,920.87,951.83,1000.00,433.14,920.87,1000.00,1000.00,882.84,882.84,1000.00,1000.00,882.84,951.83,920.87,951.83,882.84,951.83,1000.00,1000.00,951.83,882.84,882.84,1000.00,951.83,920.87,882.84,882.84,882.84,920.87,882.84,1000.00,882.84])
#f0=np.array([1151.09,1000.00,1000.00,920.87,1091.33,920.87,920.87,920.87,882.84,882.84,1000.00,560.01,882.84,1000.00,920.87,920.87,852.07,920.87,882.84,955.93,882.84,920.87,882.84,882.84,920.87,882.84,882.84,882.84,882.84,1000.00,920.87,1000.00,951.83,951.83,920.87,882.84,920.87,882.84,920.87,882.84])
f0=np.array([955.93,882.84,882.84,882.84,951.83,821.68,920.87,920.87,882.84,882.84,1045.36,560.01,882.84,882.84,1000.00,1000.00,920.87,920.87,951.83,882.84,843.45,1091.33,951.83,1000.00,1000.00,1000.00,951.83,1000.00,951.83,821.68,920.87,920.87,1000.00,920.87,882.84,882.84,852.07,951.83,951.83,920.87])
#f0=np.array([882.84,951.83,920.87,882.84,1000.00,882.84,920.87,1000.00,920.87,1000.00,951.83,571.10,882.84,882.84,1000.00,920.87,882.84,882.84,951.83,951.83,1000.00,882.84,882.84,882.84,920.87,882.84,920.87,920.87,1000.00,951.83,951.83,882.84,882.84,882.84,951.83,951.83,1000.00,852.07,1000.00,882.84])
#f0=np.array([1000.00,920.87,1000.00,1000.00,920.87,920.87,1000.00,920.87,1000.00,882.84,920.87,571.10,920.87,882.84,1000.00,882.84,920.87,920.87,920.87,951.83,882.84,920.87,1045.36,951.83,920.87,920.87,920.87,951.83,882.84,920.87,882.84,882.84,821.68,951.83,951.83,821.68,882.84,920.87,1000.00,1000.00])

#rotazione pennarello 2
f1=np.array([951.83,882.84,1000.00,821.68,951.83,920.87,920.87,821.68,821.68,920.87,920.87,602.51,821.68,821.68,920.87,882.84,1000.00,882.84,920.87,920.87,882.84,882.84,920.87,920.87,852.07,852.07,882.84,852.07,882.84,920.87,920.87,821.68,852.07,920.87,821.68,852.07,882.84,955.93,920.87,882.84])
f2=np.array([852.07,920.87,852.07,882.84,920.87,879.62,882.84,882.84,882.84,920.87,882.84,651.15,674.49,852.07,852.07,882.84,920.87,920.87,920.87,821.68,852.07,882.84,920.87,821.68,882.84,821.68,920.87,882.84,920.87,920.87,1000.00,821.68,920.87,920.87,1000.00,882.84,882.84,920.87,920.87,882.84])
f3=np.array([920.87,920.87,920.87,920.87,882.84,920.87,882.84,920.87,882.84,920.87,852.07,651.15,882.84,920.87,920.87,882.84,920.87,882.84,852.07,1000.00,852.07,882.84,920.87,920.87,882.84,882.84,852.07,920.87,852.07,821.68,920.87,821.68,920.87,951.83,920.87,821.68,955.93,1000.00,920.87,882.84])
f4=np.array([821.68,789.64,920.87,821.68,852.07,821.68,843.45,767.39,789.64,789.64,821.68,832.35,821.68,821.68,821.68,821.68,852.07,821.68,882.84,697.31,821.68,821.68,852.07,741.10,767.39,882.84,821.68,821.68,843.45,843.45,791.97,821.68,821.68,920.87,821.68,741.10,821.68,821.68,821.68,821.68])
'''
#rotazione pennarello 3 con calibrazione opposti
f0=np.array([1036.99,1000.00,1000.00,1036.99,963.84,933.93,933.93,1036.99,1074.44,933.93,1000.00,860.56,555.38,648.78,1000.00,933.93,1000.00,901.93,990.58,1272.23,1036.99,1036.99,1036.99,933.93,963.84,933.93,933.93,1000.00,1036.99,933.93,1036.99,933.93,963.84,1036.99,1036.99,1036.99,1036.99,963.84,1036.99,1000.00])
f1=np.array([963.84,1000.00,1120.71,963.84,961.00,1036.99,1000.00,1000.00,933.93,1272.23,933.93,990.58,860.56,807.13,455.41,1036.99,1070.51,963.84,963.84,1328.17,1000.00,933.93,1036.99,1000.00,963.84,933.93,1000.00,963.84,933.93,933.93,1000.00,1000.00,963.84,1036.99,1000.00,963.84,933.93,933.93,1000.00,875.13])
f2=np.array([1036.99,1036.99,1000.00,933.93,1036.99,1120.71,1000.00,1000.00,1000.00,1400.89,933.93,939.16,807.13,759.74,443.83,933.93,1036.99,1000.00,1036.99,1272.23,1036.99,1036.99,1036.99,1000.00,1000.00,1000.00,1000.00,963.84,961.00,1036.99,933.93,961.00,963.84,933.93,1000.00,1120.71,1036.99,963.84,1000.00,875.13])
f3=np.array([901.93,848.64,933.93,875.13,842.86,848.64,800.51,822.63,875.13,875.13,822.63,1163.38,1012.99,455.41,426.03,848.64,800.51,848.64,899.60,1272.23,848.64,822.63,842.86,848.64,800.51,848.64,848.64,756.96,899.60,899.60,875.13,875.13,800.51,933.93,933.93,933.93,899.60,822.63,800.51,848.64])
f4=np.array([875.13,933.93,933.93,933.93,933.93,875.13,961.00,875.13,933.93,933.93,963.84,1228.66,860.56,580.44,477.35,933.93,875.13,875.13,933.93,1400.89,933.93,933.93,1000.00,963.84,933.93,963.84,933.93,963.84,963.84,875.13,1000.00,1036.99,933.93,933.93,875.13,963.84,933.93,899.60,933.93,822.63])



data_baseline = f0
print ('f0',len(f0),len(f1),len(f2),len(f3), len(f4))
#g.update_reference(data_baseline)
# set the baseline. 

#baseline = eit_reconstruction(f0)
# do the reconstruction. 
#difference_image = eit_reconstruction(f1)
#print (difference_image)
# #print(g.__dict__)

img = []
baseline_flag = 1
n_el = 8 # number of electrodes. 
step = 1 
el_dist = 1 # random initialize number 

# we create this according to an opposition protocol to maximize contrast. 
ex_mat = eit_scan_lines(n_el =n_el, dist =el_dist)
""" 0. construct mesh """
# h0 is initial mesh size. , h0=0.1
mesh_obj= mesh.create(n_el, h0=0.08)
el_pos = mesh_obj.el_pos
protocol_obj = protocol.create(n_el, dist_exc=1, step_meas=1, parser_meas="std")

# Define electrode current sink and current source
#ex_line = protocol_obj.ex_mat[0].ravel()


""" 3. Set Up BP """
#BACKPROJECTION
eit =  bp(mesh_obj, protocol_obj)
#        self.eit =  bp(self.mesh_obj,self.el_pos, ex_mat=self.ex_mat, step=self.step, parser='std')

eit.setup(weight='none')

ds_bp_1 = eit.solve(f1, f0, normalize=True)
difference_image_1= np.real(ds_bp_1)

ds_bp_2 = eit.solve(f2, f0, normalize=True)
difference_image_2= np.real(ds_bp_2)

ds_bp_3 = eit.solve(f3, f0, normalize=True)
difference_image_3= np.real(ds_bp_3)

ds_bp_4 = eit.solve(f4, f0, normalize=True)
difference_image_4= np.real(ds_bp_4)




pts     = mesh_obj.node
tri = mesh_obj.element
x   = pts[:, 0]
y   = pts[:, 1]

#BACKPROJECTION
fig, axes = plt.subplots(1,4)
ax=axes[0]
im_1 = ax.tripcolor(x,y, tri, difference_image_1,
                  shading='flat', cmap=plt.cm.gnuplot)
fig.colorbar(im_1)
ax.plot(x[el_pos], y[el_pos], 'ro')
for i, e in enumerate(el_pos):
    ax.text(x[e], y[e], str(i+1), size=12)
ax.axis('equal')
ax=axes[1]
im_2 = ax.tripcolor(x,y, tri, difference_image_2,
                  shading='flat', cmap=plt.cm.gnuplot)
fig.colorbar(im_2)
ax.plot(x[el_pos], y[el_pos], 'ro')
for i, e in enumerate(el_pos):
    ax.text(x[e], y[e], str(i+1), size=12)
ax.axis('equal')
ax=axes[2]
im_3 = ax.tripcolor(x,y, tri, difference_image_3,
                  shading='flat', cmap=plt.cm.gnuplot)
fig.colorbar(im_3)
ax.plot(x[el_pos], y[el_pos], 'ro')
for i, e in enumerate(el_pos):
    ax.text(x[e], y[e], str(i+1), size=12)
ax.axis('equal')
ax=axes[3]
im_4 = ax.tripcolor(x,y, tri, difference_image_4,
                  shading='flat', cmap=plt.cm.gnuplot)
ax.plot(x[el_pos], y[el_pos], 'ro')
fig.colorbar(im_4)
for i, e in enumerate(el_pos):
    ax.text(x[e], y[e], str(i+1), size=12)
ax.axis('equal')
plt.show()




