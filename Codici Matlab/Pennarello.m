% Based on the 'bubble' data from Eidors2D, use several 
% different algorithms to image it

% (C) 2005 Andy Adler. License: GPL version 2 or version 3
% $Id: image_2d_algs.m 2003 2009-12-28 17:36:57Z aadler $

n_elec = 8;
n_rings= 1;
 options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('c2c0',n_elec); %576 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

f0=[920.87,955.93,852.07,852.07,852.07,920.87,821.68,1000.00,920.87,920.87,920.87,581.02,821.68,852.07,882.84,920.87,920.87,920.87,920.87,920.87,920.87,920.87,821.68,882.84,852.07,920.87,920.87,852.07,852.07,882.84,920.87,920.87,852.07,920.87,882.84,920.87,920.87,821.68,920.87,882.84]';
f1=[951.83,882.84,1000.00,821.68,951.83,920.87,920.87,821.68,821.68,920.87,920.87,602.51,821.68,821.68,920.87,882.84,1000.00,882.84,920.87,920.87,882.84,882.84,920.87,920.87,852.07,852.07,882.84,852.07,882.84,920.87,920.87,821.68,852.07,920.87,821.68,852.07,882.84,955.93,920.87,882.84]';
f2=[852.07,920.87,852.07,882.84,920.87,879.62,882.84,882.84,882.84,920.87,882.84,651.15,674.49,852.07,852.07,882.84,920.87,920.87,920.87,821.68,852.07,882.84,920.87,821.68,882.84,821.68,920.87,882.84,920.87,920.87,1000.00,821.68,920.87,920.87,1000.00,882.84,882.84,920.87,920.87,882.84]';
f3=[920.87,920.87,920.87,920.87,882.84,920.87,882.84,920.87,882.84,920.87,852.07,651.15,882.84,920.87,920.87,882.84,920.87,882.84,852.07,1000.00,852.07,882.84,920.87,920.87,882.84,882.84,852.07,920.87,852.07,821.68,920.87,821.68,920.87,951.83,920.87,821.68,955.93,1000.00,920.87,882.84]';
f4=[821.68,789.64,920.87,821.68,852.07,821.68,843.45,767.39,789.64,789.64,821.68,832.35,821.68,821.68,821.68,821.68,852.07,821.68,882.84,697.31,821.68,821.68,852.07,741.10,767.39,882.84,821.68,821.68,843.45,843.45,791.97,821.68,821.68,920.87,821.68,741.10,821.68,821.68,821.68,821.68]';

img1= inv_solve( inv_model, f0, f1);
img2= inv_solve( inv_model, f0, f2);
img3= inv_solve( inv_model, f0, f3);
img4= inv_solve( inv_model, f0, f4);
%show_fem(img1);
%show_fem(img2);
%show_fem(img3);
%show_fem(img4);

ax1 = subplot(1,4,1);
show_fem(img1)
ax2 = subplot(1,4,2);
show_fem(img2)
ax3 = subplot(1,4,3);
show_fem(img3)
ax4 = subplot(1,4,4);
show_fem(img4)
%% finger
f0=[474.05,500.00,500.00,454.08,454.08,434.37,454.08,474.05,434.37,454.08,454.08,434.37,500.00,474.05,474.05,454.08,434.37,474.05,500.00,434.37,474.05,474.05,454.08,474.05,434.37,434.37,454.08,474.05,454.08,454.08,454.08,434.37,474.05,454.08,454.08,434.37,454.08,454.08,454.08,454.08]';
f1p=[434.37,474.05,474.05,454.08,500.00,434.37,454.08,454.08,434.37,434.37,454.08,434.37,454.08,500.00,474.05,415.23,454.08,454.08,474.05,434.37,474.05,434.37,454.08,434.37,454.08,454.08,474.05,454.08,500.00,454.08,474.05,500.00,434.37,434.37,500.00,434.37,474.05,474.05,474.05,474.05]';
f2=[500.00,434.37,454.08,474.05,454.08,454.08,454.08,500.00,471.40,434.37,500.00,500.00,474.05,454.08,523.42,454.08,500.00,415.23,454.08,474.05,454.08,474.05,500.00,474.05,500.00,500.00,474.05,454.08,454.08,474.05,454.08,434.37,454.08,500.00,474.05,500.00,434.37,454.08,500.00,454.08]';
f3=[454.08,500.00,454.08,500.00,454.08,434.37,454.08,415.23,454.08,474.05,454.08,454.08,434.37,474.05,554.70,454.08,454.08,434.37,500.00,434.37,500.00,454.08,500.00,500.00,474.05,500.00,500.00,454.08,500.00,474.05,474.05,500.00,500.00,454.08,500.00,434.37,500.00,454.08,500.00,434.37]';
f4=[500.00,500.00,500.00,500.00,554.70,454.08,454.08,500.00,454.08,434.37,500.00,500.00,454.08,500.00,454.08,500.00,434.37,434.37,474.05,434.37,500.00,454.08,500.00,434.37,454.08,454.08,500.00,454.08,434.37,500.00,500.00,474.05,500.00,454.08,454.08,500.00,454.08,454.08,500.00,474.05]';

img1= inv_solve( inv_model, f0, f1p);
img2= inv_solve( inv_model, f0, f2);
img3= inv_solve( inv_model, f0, f3);
img4= inv_solve( inv_model, f0, f4);

ax1 = subplot(1,4,1);
show_fem(img1)
ax2 = subplot(1,4,2);
show_fem(img2)
ax3 = subplot(1,4,3);
show_fem(img3)
ax4 = subplot(1,4,4);
show_fem(img4)

%% dito Alessandra
n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

f0a=[108.86,108.86,101.98,110.81,103.83,114.35,116.62,120.38,120.38,123.03,108.86,120.38,130.13,117.53,106.73,120.38,130.13,120.38,116.62,114.35,123.03,120.38,106.73,116.62,120.38,117.53,110.81,116.62,120.38,120.38,108.86,120.38,123.03,120.38,130.13,127.01,123.03,114.35,123.03,123.03]';
f1a=[138.03,141.42,141.42,150.94,142.39,146.84,138.03,138.03,150.94,141.42,138.03,141.42,156.70,146.84,150.94,146.84,150.94,150.94,146.84,150.94,138.03,150.94,141.42,138.03,150.94,150.94,138.03,146.84,146.84,150.94,138.03,138.03,161.72,161.72,161.72,146.84,146.84,138.03,141.42,146.84]';
f2a=[130.13,123.03,116.62,130.13,132.97,120.38,127.01,134.32,130.13,138.03,123.03,138.03,138.03,127.01,120.38,138.03,123.03,138.03,118.64,127.01,138.03,127.01,114.35,130.13,125.42,134.32,130.13,130.13,120.38,120.38,120.38,130.13,130.38,134.32,130.13,127.01,127.01,130.13,123.03,141.42]';
f3a=[114.35,110.81,108.86,117.53,110.81,123.03,114.35,120.38,120.38,116.62,120.38,127.01,116.62,116.62,108.86,120.38,130.13,123.03,108.86,120.38,120.38,120.38,120.38,114.35,117.53,120.38,108.86,123.03,120.38,120.38,106.73,116.62,114.35,123.03,123.03,120.38,120.38,120.38,116.62,116.62]';
f4a=[114.35,106.73,106.73,114.35,108.86,114.35,111.90,108.86,114.35,120.38,106.73,103.83,111.90,111.90,101.98,108.86,108.86,111.90,108.86,108.86,108.86,106.73,101.98,111.90,108.86,114.35,97.60,114.35,108.86,108.86,100.00,114.35,110.81,108.86,114.35,111.90,111.90,108.86,108.86,108.86]';

img1a= inv_solve( inv_model, f0a, f1a);
img2a= inv_solve( inv_model, f0a, f2a);
img3a= inv_solve( inv_model, f0a, f3a);
img4a= inv_solve( inv_model, f0a, f4a);

ax1a = subplot(1,4,1);
show_fem(img1a)
ax2a = subplot(1,4,2);
show_fem(img2a)
ax3a = subplot(1,4,3);
show_fem(img3a)
ax4a = subplot(1,4,4);
show_fem(img4a)

%% pennarello dritto
n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

f0p=[1054.75,1000.00,1054.75,994.43,1096.68,957.88,1054.75,1054.75,1054.75,957.88,1054.75,1054.75,957.88,1054.75,1170.14,1054.75,1054.75,1054.75,1054.75,916.31,1054.75,957.88,1054.75,1096.68,1104.16,1000.00,1054.75,916.31,1054.75,1054.75,1054.75,957.88,1054.75,957.88,1054.75,1000.00,1000.00,1000.00,1054.75,1054.75]';
f1p=[994.43,1054.75,1054.75,1054.75,1170.14,1054.75,1054.75,1054.75,957.88,957.88,1054.75,1000.00,957.88,1000.00,1170.14,1054.75,1054.75,957.88,957.88,916.31,1054.75,1054.75,1054.75,916.31,1000.00,1054.75,1054.75,916.31,957.88,957.88,957.88,957.88,957.88,1054.75,916.31,957.88,1096.68,1054.75,957.88,1000.00]';
f2p=[1054.75,957.88,1054.75,1054.75,1054.75,1000.00,957.88,1054.75,1054.75,1000.00,1000.00,1054.75,1054.75,1054.75,1054.75,1054.75,1054.75,1000.00,1054.75,957.88,1054.75,1054.75,1000.00,916.31,1104.16,957.88,994.43,916.31,916.31,1054.75,1096.68,957.88,916.31,875.92,957.88,916.31,916.31,957.88,1054.75,916.31]';
f3p=[957.88,1054.75,1000.00,957.88,1054.75,916.31,957.88,1054.75,1054.75,957.88,1054.75,1054.75,1054.75,1000.00,1054.75,1054.75,1054.75,1054.75,957.88,843.80,957.88,957.88,1054.75,957.88,1054.75,957.88,916.31,957.88,1054.75,1000.00,1054.75,1054.75,957.88,1000.00,957.88,916.31,1096.68,1054.75,957.88,957.88]';
f4p=[1000.00,957.88,1054.75,1000.00,1054.75,1054.75,957.88,957.88,1054.75,1000.00,957.88,957.88,1054.75,1000.00,1054.75,957.88,957.88,957.88,1170.14,1054.75,957.88,1054.75,1054.75,957.88,957.88,957.88,1054.75,843.80,1054.75,1054.75,1054.75,957.88,957.88,1054.75,957.88,957.88,1000.00,957.88,994.43,957.88]';

img1p= inv_solve( inv_model, f0p, f1p);
img2p= inv_solve( inv_model, f0p, f2p);
img3p= inv_solve( inv_model, f0p, f3p);
img4p= inv_solve( inv_model, f0p, f4p);

ax1p = subplot(1,4,1);
show_fem(img1p)
ax2p = subplot(1,4,2);
show_fem(img2p)
ax3p = subplot(1,4,3);
show_fem(img3p)
ax4p = subplot(1,4,4);
show_fem(img4p)

%% pennarello 08/06 movimento: 1-2,4-5,6-7,8-1

n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;


f0m=[508.91,473.01,473.01,473.01,508.91,473.01,525.36,508.91,508.91,473.01,508.91,473.01,525.36,490.76,473.01,508.91,473.01,458.33,473.01,473.01,508.91,429.48,473.01,508.91,473.01,473.01,508.91,473.01,508.91,473.01,473.01,473.01,508.91,473.01,473.01,458.33,508.91,473.01,473.01,473.01]';
f1m=[508.91,486.14,525.36,525.36,525.36,473.01,508.91,508.91,473.01,473.01,508.91,508.91,508.91,508.91,525.36,473.01,473.01,508.91,508.91,473.01,508.91,473.01,508.91,508.91,508.91,473.01,508.91,508.91,508.91,525.36,508.91,486.14,525.36,508.91,525.36,486.14,550.00,508.91,458.33,486.14]';
f2m=[525.36,550.00,508.91,508.91,570.94,508.91,525.36,508.91,508.91,525.36,550.00,525.36,508.91,508.91,508.91,473.01,525.36,473.01,550.00,508.91,508.91,525.36,525.36,508.91,525.36,473.01,525.36,550.00,486.14,473.01,550.00,473.01,508.91,473.01,525.36,508.91,473.01,490.76,490.76,508.91]';
f3m=[525.36,550.00,525.36,508.91,525.36,473.01,508.91,508.91,473.01,473.01,508.91,550.00,508.91,508.91,525.36,508.91,508.91,473.01,508.91,508.91,525.36,550.00,550.00,508.91,508.91,508.91,550.00,525.36,486.14,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91]';
f4m=[570.94,550.00,525.36,550.00,525.36,508.91,525.36,525.36,473.01,508.91,508.91,486.14,508.91,550.00,550.00,490.76,508.91,473.01,473.01,473.01,473.01,525.36,508.91,508.91,508.91,508.91,508.91,486.14,508.91,473.01,508.91,508.91,508.91,508.91,508.91,486.14,508.91,486.14,570.94,473.01]';
img1m= inv_solve( inv_model, f0m, f1m);
img2m= inv_solve( inv_model, f0m, f2m);
img3m= inv_solve( inv_model, f0m, f3m);
img4m= inv_solve( inv_model, f0m, f4m);
%img1p.show_fem.electrode.number.show = 1;
%opts.colorbar.show = 1;
%show_fem(img1p.opts)
ax1m = subplot(1,4,1);
show_fem(img1m)
ax2m = subplot(1,4,2);
show_fem(img2m)
ax3m = subplot(1,4,3);
show_fem(img3m)
ax4m = subplot(1,4,4);
show_fem(img4m)

%% backprojection
% Backprojection Solver
inv_BP= eidors_obj('inv_model','BP_solver','fwd_model', img.fwd_model);
inv_BP.reconst_type= 'difference';
inv_BP.solve= @inv_solve_backproj;
%inv_BP.inv_solve_backproj.type= 'naive';

%vh=[508.91,473.01,473.01,473.01,508.91,473.01,525.36,508.91,508.91,473.01,508.91,473.01,525.36,490.76,473.01,508.91,473.01,458.33,473.01,473.01,508.91,429.48,473.01,508.91,473.01,473.01,508.91,473.01,508.91,473.01,473.01,473.01,508.91,473.01,473.01,458.33,508.91,473.01,473.01,473.01]';
%v1=[508.91,486.14,525.36,525.36,525.36,473.01,508.91,508.91,473.01,473.01,508.91,508.91,508.91,508.91,525.36,473.01,473.01,508.91,508.91,473.01,508.91,473.01,508.91,508.91,508.91,473.01,508.91,508.91,508.91,525.36,508.91,486.14,525.36,508.91,525.36,486.14,550.00,508.91,458.33,486.14]';
%v2=[525.36,550.00,508.91,508.91,570.94,508.91,525.36,508.91,508.91,525.36,550.00,525.36,508.91,508.91,508.91,473.01,525.36,473.01,550.00,508.91,508.91,525.36,525.36,508.91,525.36,473.01,525.36,550.00,486.14,473.01,550.00,473.01,508.91,473.01,525.36,508.91,473.01,490.76,490.76,508.91]';
%v3=[525.36,550.00,525.36,508.91,525.36,473.01,508.91,508.91,473.01,473.01,508.91,550.00,508.91,508.91,525.36,508.91,508.91,473.01,508.91,508.91,525.36,550.00,550.00,508.91,508.91,508.91,550.00,525.36,486.14,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91]';
%v4=[570.94,550.00,525.36,550.00,525.36,508.91,525.36,525.36,473.01,508.91,508.91,486.14,508.91,550.00,550.00,490.76,508.91,473.01,473.01,473.01,473.01,525.36,508.91,508.91,508.91,508.91,508.91,486.14,508.91,473.01,508.91,508.91,508.91,508.91,508.91,486.14,508.91,486.14,570.94,473.01]';
f0b=[920.87,955.93,852.07,852.07,852.07,920.87,821.68,1000.00,920.87,920.87,920.87,581.02,821.68,852.07,882.84,920.87,920.87,920.87,920.87,920.87,920.87,920.87,821.68,882.84,852.07,920.87,920.87,852.07,852.07,882.84,920.87,920.87,852.07,920.87,882.84,920.87,920.87,821.68,920.87,882.84]';
f1b=[951.83,882.84,1000.00,821.68,951.83,920.87,920.87,821.68,821.68,920.87,920.87,602.51,821.68,821.68,920.87,882.84,1000.00,882.84,920.87,920.87,882.84,882.84,920.87,920.87,852.07,852.07,882.84,852.07,882.84,920.87,920.87,821.68,852.07,920.87,821.68,852.07,882.84,955.93,920.87,882.84]';
f2b=[852.07,920.87,852.07,882.84,920.87,879.62,882.84,882.84,882.84,920.87,882.84,651.15,674.49,852.07,852.07,882.84,920.87,920.87,920.87,821.68,852.07,882.84,920.87,821.68,882.84,821.68,920.87,882.84,920.87,920.87,1000.00,821.68,920.87,920.87,1000.00,882.84,882.84,920.87,920.87,882.84]';
f3b=[920.87,920.87,920.87,920.87,882.84,920.87,882.84,920.87,882.84,920.87,852.07,651.15,882.84,920.87,920.87,882.84,920.87,882.84,852.07,1000.00,852.07,882.84,920.87,920.87,882.84,882.84,852.07,920.87,852.07,821.68,920.87,821.68,920.87,951.83,920.87,821.68,955.93,1000.00,920.87,882.84]';
f4b=[821.68,789.64,920.87,821.68,852.07,821.68,843.45,767.39,789.64,789.64,821.68,832.35,821.68,821.68,821.68,821.68,852.07,821.68,882.84,697.31,821.68,821.68,852.07,741.10,767.39,882.84,821.68,821.68,843.45,843.45,791.97,821.68,821.68,920.87,821.68,741.10,821.68,821.68,821.68,821.68]';

inv_BP.inv_solve_backproj.type= 'simple_filter';
%inv_BP.inv_solve_backproj.
imgr1= inv_solve(inv_BP, f0b,f1b);
imgr2= inv_solve(inv_BP, f0b,f2b);
imgr3= inv_solve(inv_BP, f0b,f3b);
imgr4= inv_solve(inv_BP, f0b,f4b);
%imgr.calc_colours.ref_level=0;
ax1r = subplot(1,4,1);
show_fem(imgr1,1)
ax2r = subplot(1,4,2);
show_fem(imgr2,1)
ax3r = subplot(1,4,3);
show_fem(imgr3,1)
ax4r = subplot(1,4,4);
show_fem(imgr4,1)
axis equal

%% GREIT (NON FUNZIONA?!)
n_elec=8;
fmdl= mk_common_model('d2c0',n_elec);
%fmdl.electrode = fmdl.electrode([9:16,1:8]);
img = mk_image(fmdl, 1); % background conductivity
%img.elem_data([fmdl.mat_idx{2};fmdl.mat_idx{3}]) = 0.3; % lungs
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[stim, msel]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
img.fwd_model.stimulation = stim;
img.fwd_model = mdl_normalize(img.fwd_model, 1);
opt.imgsz = [32 32];
opt.distr = 3; % non-random, uniform
opt.Nsim = 500; % 500 hundred targets to train on, seems enough
opt.target_size = 0.03; %small targets
opt.target_offset = 0;
opt.noise_figure = .5; % this is key!
opt.square_pixels = 1;
imdl=mk_GREIT_model(img, 0.25, [], opt);
imdl.fwd_model.meas_select = msel;

vh=[508.91,473.01,473.01,473.01,508.91,473.01,525.36,508.91,508.91,473.01,508.91,473.01,525.36,490.76,473.01,508.91,473.01,458.33,473.01,473.01,508.91,429.48,473.01,508.91,473.01,473.01,508.91,473.01,508.91,473.01,473.01,473.01,508.91,473.01,473.01,458.33,508.91,473.01,473.01,473.01]';
v1=[508.91,486.14,525.36,525.36,525.36,473.01,508.91,508.91,473.01,473.01,508.91,508.91,508.91,508.91,525.36,473.01,473.01,508.91,508.91,473.01,508.91,473.01,508.91,508.91,508.91,473.01,508.91,508.91,508.91,525.36,508.91,486.14,525.36,508.91,525.36,486.14,550.00,508.91,458.33,486.14]';
v2=[525.36,550.00,508.91,508.91,570.94,508.91,525.36,508.91,508.91,525.36,550.00,525.36,508.91,508.91,508.91,473.01,525.36,473.01,550.00,508.91,508.91,525.36,525.36,508.91,525.36,473.01,525.36,550.00,486.14,473.01,550.00,473.01,508.91,473.01,525.36,508.91,473.01,490.76,490.76,508.91]';
v3=[525.36,550.00,525.36,508.91,525.36,473.01,508.91,508.91,473.01,473.01,508.91,550.00,508.91,508.91,525.36,508.91,508.91,473.01,508.91,508.91,525.36,550.00,550.00,508.91,508.91,508.91,550.00,525.36,486.14,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91,508.91]';
v4=[570.94,550.00,525.36,550.00,525.36,508.91,525.36,525.36,473.01,508.91,508.91,486.14,508.91,550.00,550.00,490.76,508.91,473.01,473.01,473.01,473.01,525.36,508.91,508.91,508.91,508.91,508.91,486.14,508.91,473.01,508.91,508.91,508.91,508.91,508.91,486.14,508.91,486.14,570.94,473.01]';

img= inv_solve(imdl,vh,v1);

img.calc_colours.ref_level = 0;

show_fem(img);

%% rotazione penn 29-05
r0 = [10469.00,10469.00,10469.00,10469.00,10469.00,10469.00,10469.00,10469.00,10469.00,10000.00,10469.00,10469.00,9686.88,10867.54,9686.88,10469.00,10469.00,10469.00,10469.00,9686.88,10000.00,10469.00,10469.00,10000.00,10000.00,10000.00,10867.54,10000.00,10000.00,10000.00,9686.88,9686.88,9686.88,9686.88,9686.88,9686.88,10867.54,10000.00,9686.88,10867.54]';
r1 = [9003.62,10469.00,10000.00,10469.00,10000.00,11368.61,10000.00,9686.88,9253.38,10469.00,10469.00,9686.88,9686.88,10000.00,9003.62,10000.00,9003.62,10867.54,10867.54,10469.00,9686.88,10867.54,10867.54,9686.88,10000.00,10000.00,10469.00,10469.00,10469.00,10469.00,10867.54,9686.88,9686.88,10469.00,10469.00,9686.88,10867.54,10867.54,9686.88,10867.54]';
r2 = [10000.00,9253.38,10867.54,10469.00,10469.00,9686.88,10867.54,10469.00,9686.88,10000.00,9686.88,10469.00,9253.38,10000.00,10000.00,9686.88,9686.88,9003.62,10000.00,9686.88,9686.88,9686.88,10000.00,10000.00,9686.88,9686.88,10469.00,9686.88,9686.88,10000.00,10867.54,10000.00,10469.00,9003.62,10867.54,10469.00,10000.00,10000.00,10867.54,8724.17]';
r3 = [10469.00,10867.54,10469.00,9686.88,9686.88,10469.00,9686.88,10000.00,10000.00,9253.38,9253.38,10469.00,9686.88,10867.54,10469.00,10000.00,9686.88,9253.38,9686.88,9686.88,9341.37,10867.54,10867.54,9686.88,10000.00,9686.88,10867.54,10469.00,10000.00,9686.88,9003.62,9686.88,9686.88,10469.00,9003.62,9686.88,10000.00,10469.00,9686.88,10000.00]';
r4 = [10000.00,9686.88,10000.00,10000.00,10469.00,9253.38,9686.88,9686.88,9686.88,10000.00,10000.00,9686.88,10000.00,10000.00,10000.00,9686.88,9686.88,10000.00,9686.88,10867.54,10000.00,9686.88,10867.54,9686.88,9253.38,10000.00,10867.54,10000.00,9686.88,9253.38,10469.00,9686.88,10000.00,9686.88,9686.88,10000.00,10000.00,10469.00,10000.00,10000.00]';

n_elec = 8;
n_rings= 1;
 options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

img1r= inv_solve( inv_model, r0, r1);
img2r= inv_solve( inv_model, r0, r2);
img3r= inv_solve( inv_model, r0, r3);
img4r= inv_solve( inv_model, r0, r4);


arx1 = subplot(1,4,1);
show_fem(img1r)
arx2 = subplot(1,4,2);
show_fem(img2r)
arx3 = subplot(1,4,3);
show_fem(img3r)
arx4 = subplot(1,4,4);
show_fem(img4r)

%%
inv_BP= eidors_obj('inv_model','BP_solver','fwd_model', img.fwd_model);
inv_BP.reconst_type= 'difference';
inv_BP.solve= @inv_solve_backproj;


inv_BP.inv_solve_backproj.type= 'simple_filter';
%inv_BP.inv_solve_backproj.
imgr1a= inv_solve(inv_BP, r0,r1);
imgr2a= inv_solve(inv_BP, r0,r2);
imgr3a= inv_solve(inv_BP, r0,r3);
imgr4a= inv_solve(inv_BP, r0,r4);
%imgr.calc_colours.ref_level=0;
ax1ra = subplot(1,4,1);
show_fem(imgr1a,1)
ax2ra = subplot(1,4,2);
show_fem(imgr2a,1)
ax3ra = subplot(1,4,3);
show_fem(imgr3a,1)
ax4ra = subplot(1,4,4);
show_fem(imgr4a,1)
axis equal
%% pennarello dritto centro 08/06
a0=[550.00,550.00,511.21,550.00,567.78,511.21,567.78,511.21,617.04,550.00,525.39,550.00,550.00,550.00,594.41,550.00,511.21,511.21,550.00,525.39,511.21,525.39,550.00,511.21,525.39,550.00,550.00,511.21,550.00,495.34,550.00,550.00,594.41,550.00,511.21,550.00,511.21,567.78,550.00,550.00]';
a1=[594.41,567.78,567.78,550.00,594.41,511.21,550.00,511.21,550.00,550.00,550.00,550.00,594.41,511.21,550.00,511.21,530.38,511.21,550.00,525.39,594.41,567.78,550.00,550.00,511.21,511.21,567.78,550.00,550.00,550.00,594.41,525.39,550.00,525.39,511.21,511.21,550.00,511.21,550.00,567.78]';
a2=[594.41,550.00,550.00,567.78,567.78,550.00,550.00,550.00,550.00,550.00,550.00,550.00,550.00,567.78,550.00,495.34,550.00,594.41,511.21,511.21,550.00,550.00,567.78,550.00,511.21,511.21,567.78,511.21,550.00,567.78,594.41,550.00,530.38,550.00,511.21,567.78,550.00,511.21,550.00,530.38]';
a3=[594.41,550.00,567.78,511.21,550.00,550.00,525.39,511.21,511.21,511.21,550.00,550.00,511.21,550.00,550.00,567.78,550.00,550.00,550.00,550.00,550.00,550.00,594.41,550.00,550.00,511.21,567.78,511.21,550.00,550.00,594.41,530.38,511.21,550.00,550.00,511.21,550.00,567.78,567.78,511.21]';
a4=[594.41,567.78,567.78,550.00,550.00,525.39,594.41,511.21,550.00,550.00,511.21,511.21,550.00,567.78,594.41,550.00,550.00,530.38,550.00,550.00,511.21,594.41,550.00,594.41,550.00,550.00,550.00,594.41,550.00,525.39,550.00,550.00,550.00,550.00,550.00,511.21,594.41,525.39,567.78,530.38]';

img_a1_inv=inv_solve(inv_model, a0,a1);
img_a2_inv=inv_solve(inv_model, a0,a2);
img_a3_inv=inv_solve(inv_model, a0,a3);
img_a4_inv=inv_solve(inv_model, a0,a4);

img_a1_inv.calc_colours.ref_level=0;
img_a2_inv.calc_colours.ref_level=0;
img_a3_inv.calc_colours.ref_level=0;
img_a4_inv.calc_colours.ref_level=0;
ax_a_1 = subplot(1,4,1);
show_fem(img_a1_inv)
ax_a_2 = subplot(1,4,2);
show_fem(img_a2_inv)
ax_a_3 = subplot(1,4,3);
show_fem(img_a3_inv)
ax_a_4 = subplot(1,4,4);
show_fem(img_a4_inv)
axis equal
%% penn dritto bp

img_a1_bp=inv_solve(inv_BP, a0,a1);
img_a2_bp=inv_solve(inv_BP, a0,a2);
img_a3_bp=inv_solve(inv_BP, a0,a3);
img_a4_bp=inv_solve(inv_BP, a0,a4);


img_a1_bp.calc_colours.ref_level=0;
img_a2_bp.calc_colours.ref_level=0;
img_a3_bp.calc_colours.ref_level=0;
img_a4_bp.calc_colours.ref_level=0;
ax_a_1bp = subplot(1,4,1);
show_fem(img_a1_bp)
ax_a_2bp = subplot(1,4,2);
show_fem(img_a2_bp)
ax_a_3bp = subplot(1,4,3);
show_fem(img_a3_bp)
ax_a_4bp = subplot(1,4,4);
show_fem(img_a4_bp)
axis equal

%% penn mov 1-2 4-5 6-7 8-1
b0=[490.25,550.00,506.09,529.83,506.09,506.09,506.09,490.25,490.25,550.00,506.09,550.00,490.25,506.09,506.09,550.00,506.09,455.67,506.09,550.00,529.83,550.00,490.25,490.25,529.83,529.83,506.09,506.09,506.09,529.83,506.09,529.83,506.09,490.25,529.83,490.25,490.25,550.00,506.09,506.09]';
b1=[506.09,601.46,490.25,529.83,506.09,550.00,550.00,490.25,455.67,490.25,506.09,529.83,490.25,601.46,550.00,506.09,490.25,506.09,506.09,529.83,506.09,550.00,550.00,529.83,550.00,601.46,550.00,550.00,468.31,550.00,529.83,490.25,550.00,506.09,529.83,550.00,529.83,506.09,490.25,529.83]';
b2=[550.00,529.83,601.46,529.83,550.00,529.83,550.00,506.09,550.00,506.09,550.00,506.09,506.09,506.09,550.00,490.25,550.00,490.25,506.09,472.76,529.83,550.00,506.09,506.09,550.00,550.00,529.83,506.09,506.09,550.00,550.00,529.83,490.25,506.09,506.09,550.00,490.25,529.83,550.00,506.09]';
b3=[550.00,550.00,550.00,529.83,550.00,506.09,529.83,506.09,550.00,490.25,550.00,506.09,506.09,506.09,506.09,550.00,550.00,506.09,550.00,506.09,506.09,468.31,506.09,529.83,529.83,506.09,550.00,506.09,490.25,529.83,550.00,506.09,506.09,529.83,529.83,506.09,550.00,550.00,550.00,506.09]';
b4=[550.00,550.00,490.25,550.00,601.46,550.00,529.83,550.00,529.83,529.83,490.25,529.83,550.00,506.09,550.00,550.00,506.09,490.25,455.67,529.83,506.09,506.09,529.83,506.09,550.00,506.09,550.00,506.09,529.83,506.09,550.00,506.09,550.00,529.83,490.25,550.00,529.83,550.00,550.00,529.83]';

img_b1_inv=inv_solve(inv_model, b0,b1);
img_b2_inv=inv_solve(inv_model, b0,b2);
img_b3_inv=inv_solve(inv_model, b0,b3);
img_b4_inv=inv_solve(inv_model, b0,b4);

img_b1_inv.calc_colours.ref_level=0;
img_b2_inv.calc_colours.ref_level=0;
img_b3_inv.calc_colours.ref_level=0;
img_b4_inv.calc_colours.ref_level=0;
ax_b_1 = subplot(1,4,1);
show_fem(img_b1_inv)
ax_b_2 = subplot(1,4,2);
show_fem(img_b2_inv)
ax_b_3 = subplot(1,4,3);
show_fem(img_b3_inv)
ax_b_4 = subplot(1,4,4);
show_fem(img_b4_inv)
axis equal

%% 

img_b1_bp=inv_solve(inv_BP, b0,b1);
img_b2_bp=inv_solve(inv_BP, b0,b2);
img_b3_bp=inv_solve(inv_BP, b0,b3);
img_b4_bp=inv_solve(inv_BP, b0,b4);


img_b1_bp.calc_colours.ref_level=0;
img_b2_bp.calc_colours.ref_level=0;
img_b3_bp.calc_colours.ref_level=0;
img_b4_bp.calc_colours.ref_level=0;
ax_b_1bp = subplot(1,4,1);
show_fem(img_b1_bp)
ax_b_2bp = subplot(1,4,2);
show_fem(img_b2_bp)
ax_b_3bp = subplot(1,4,3);
show_fem(img_b3_bp)
ax_b_4bp = subplot(1,4,4);
show_fem(img_b4_bp)
axis equal

%% aggeggio plastica
c0=[550.00,550.00,597.71,597.71,597.71,597.71,597.71,597.71,597.71,550.00,575.80,597.71,550.00,550.00,597.71,550.00,597.71,597.71,575.80,532.78,575.80,575.80,575.80,550.00,575.80,532.78,575.80,575.80,532.78,597.71,597.71,532.78,597.71,532.78,575.80,495.20,597.71,575.80,550.00,575.80]';
c1=[597.71,575.80,575.80,575.80,597.71,575.80,532.78,532.78,597.71,532.78,550.00,597.71,575.80,550.00,532.78,532.78,552.02,575.80,597.71,550.00,532.78,532.78,532.78,597.71,550.00,550.00,575.80,597.71,550.00,597.71,597.71,575.80,575.80,575.80,508.94,532.78,597.71,550.00,532.78,575.80]';
c2=[575.80,550.00,575.80,597.71,532.78,597.71,532.78,532.78,575.80,550.00,532.78,575.80,597.71,575.80,575.80,550.00,532.78,597.71,575.80,597.71,550.00,597.71,597.71,575.80,495.20,575.80,597.71,597.71,550.00,532.78,532.78,550.00,575.80,532.78,597.71,575.80,575.80,550.00,532.78,550.00]';
c01=[561.97,561.97,572.96,550.53,530.07,530.07,540.26,550.00,550.00,561.97,561.97,540.26,550.00,561.97,561.97,550.53,561.97,550.00,550.53,540.26,561.97,540.26,572.96,561.97,530.07,540.26,540.26,540.26,510.88,540.26,540.26,550.53,540.26,540.26,540.26,550.53,550.00,550.53,540.26,550.00]';
c3=[650.64,697.04,668.82,719.53,719.53,759.14,719.53,777.82,735.37,719.53,735.37,719.53,759.14,719.53,683.50,719.53,802.81,777.82,719.53,719.53,802.81,759.14,719.53,719.53,759.14,719.53,683.50,735.37,759.14,802.81,719.53,802.81,777.82,825.00,777.82,759.14,683.50,777.82,777.82,802.81]';
c4=[777.82,851.08,794.75,802.81,825.00,825.00,825.00,877.65,877.65,902.19,825.00,902.19,936.62,877.65,759.14,966.62,877.65,802.81,802.81,877.65,877.65,877.65,777.82,825.00,825.00,966.62,802.81,825.00,902.19,877.65,877.65,936.62,802.81,936.62,877.65,825.00,902.19,877.65,825.00,877.65]';

img_c1_inv=inv_solve(inv_model, c0,c1);
img_c2_inv=inv_solve(inv_model, c0,c2);
img_c3_inv=inv_solve(inv_model, c01,c3);
img_c4_inv=inv_solve(inv_model, c0,c4);

img_c1_inv.calc_colours.ref_level=0;
img_c2_inv.calc_colours.ref_level=0;
img_c3_inv.calc_colours.ref_level=0;
img_c4_inv.calc_colours.ref_level=0;
ax_c_1 = subplot(1,4,1);
show_fem(img_c1_inv)
ax_c_2 = subplot(1,4,2);
show_fem(img_c2_inv)
ax_c_3 = subplot(1,4,3);
show_fem(img_c3_inv)
ax_c_4 = subplot(1,4,4);
show_fem(img_c4_inv)
axis equal

%% aggeggio bp

img_c1_bp=inv_solve(inv_BP, c0,c1);
img_c2_bp=inv_solve(inv_BP, c0,c2);
img_c3_bp=inv_solve(inv_BP, c01,c3);
img_c4_bp=inv_solve(inv_BP, c0,c4);


img_c1_bp.calc_colours.ref_level=0;
img_c2_bp.calc_colours.ref_level=0;
img_c3_bp.calc_colours.ref_level=0;
img_c4_bp.calc_colours.ref_level=0;
ax_c_1bp = subplot(1,4,1);
show_fem(img_c1_bp)
ax_c_2bp = subplot(1,4,2);
show_fem(img_c2_bp)
ax_c_3bp = subplot(1,4,3);
show_fem(img_c3_bp)
ax_c_4bp = subplot(1,4,4);
show_fem(img_c4_bp)
axis equal

%% media pennarello centro 0906
n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;
baseline=[550.00,534.78,550.00,572.24,515.45,565.22,534.78,572.24,529.03,589.44,515.45,515.45,572.24,565.22,542.53,565.22,529.03,565.22,550.00,572.24,497.13,589.44,534.78,565.22,534.78,565.22,550.00,550.00,550.00,572.24,565.22,534.78,529.03,515.45,497.13,589.44,550.00,589.44,550.00,515.45;
529.03,515.45,515.45,515.45,529.03,555.15,534.78,565.22,589.44,589.44,534.78,509.29,529.03,550.00,529.03,550.00,515.45,589.44,529.03,565.22,529.03,572.24,497.13,550.00,550.00,589.44,529.03,589.44,572.24,565.22,572.24,550.00,519.68,529.03,497.13,565.22,550.00,572.24,555.15,534.78;
529.03,529.03,572.24,550.00,550.00,550.00,572.24,572.24,550.00,550.00,550.00,550.00,529.03,589.44,529.03,589.44,519.68,565.22,529.03,589.44,534.78,529.03,550.00,550.00,572.24,589.44,542.53,589.44,565.22,565.22,572.24,534.78,515.45,515.45,534.78,534.78,589.44,565.22,550.00,572.24;
550.00,529.03,534.78,550.00,534.78,550.00,550.00,550.00,550.00,565.22,529.03,534.78,529.03,572.24,534.78,565.22,565.22,580.27,534.78,589.44,509.29,572.24,550.00,529.03,572.24,589.44,550.00,589.44,589.44,550.00,550.00,550.00,529.03,515.45,515.45,565.22,542.53,550.00,565.22,572.24;
534.78,534.78,550.00,509.29,515.45,550.00,550.00,572.24,542.53,589.44,529.03,529.03,515.45,550.00,550.00,550.00,515.45,589.44,550.00,589.44,515.45,550.00,550.00,529.03,572.24,565.22,534.78,565.22,542.53,555.15,565.22,542.53,529.03,529.03,534.78,589.44,565.22,550.00,534.78,565.22;
515.45,534.78,534.78,534.78,550.00,589.44,515.45,550.00,529.03,615.27,519.68,542.53,484.93,565.22,550.00,565.22,515.45,580.27,529.03,572.24,509.29,565.22,572.24,534.78,550.00,550.00,534.78,589.44,529.03,550.00,542.53,529.03,515.45,497.13,534.78,550.00,555.15,580.27,515.45,542.53;
550.00,550.00,534.78,534.78,497.13,550.00,534.78,550.00,550.00,550.00,515.45,519.68,542.53,565.22,515.45,572.24,529.03,572.24,534.78,550.00,509.29,550.00,534.78,615.27,572.24,550.00,534.78,565.22,572.24,565.22,534.78,534.78,542.53,515.45,534.78,550.00,550.00,572.24,550.00,534.78;
550.00,515.45,534.78,529.03,515.45,550.00,542.53,565.22,534.78,572.24,529.03,529.03,515.45,565.22,534.78,565.22,529.03,565.22,529.03,589.44,529.03,589.44,534.78,572.24,550.00,589.44,542.53,529.03,589.44,565.22,529.03,572.24,515.45,515.45,515.45,572.24,572.24,550.00,550.00,542.53;
565.22,572.24,501.89,529.03,529.03,550.00,572.24,572.24,529.03,550.00,509.29,565.22,484.93,589.44,550.00,589.44,529.03,589.44,550.00,572.24,529.03,565.22,529.03,534.78,550.00,565.22,565.22,589.44,565.22,589.44,534.78,515.45,529.03,509.29,534.78,550.00,550.00,589.44,515.45,565.22;
550.00,550.00,550.00,515.45,529.03,550.00,534.78,542.53,542.53,550.00,550.00,529.03,534.78,550.00,550.00,565.22,529.03,589.44,555.15,565.22,529.03,589.44,550.00,550.00,555.15,565.22,515.45,565.22,565.22,565.22,529.03,550.00,484.93,550.00,529.03,550.00,572.24,550.00,555.15,565.22];

frame=[550.00,550.00,515.45,550.00,550.00,550.00,572.24,572.24,550.00,550.00,550.00,550.00,515.45,589.44,550.00,572.24,550.00,565.22,550.00,572.24,501.89,565.22,534.78,550.00,550.00,550.00,555.81,565.22,565.22,565.22,529.03,550.00,534.78,529.03,529.03,589.44,572.24,565.22,565.22,542.53;
550.00,515.45,529.03,550.00,515.45,550.00,550.00,565.22,529.03,550.00,515.45,550.00,515.45,572.24,542.53,589.44,534.78,565.22,550.00,589.44,529.03,565.22,572.24,550.00,565.22,572.24,589.44,606.57,589.44,550.00,550.00,589.44,534.78,529.03,515.45,565.22,580.27,550.00,589.44,565.22;
550.00,515.45,534.78,515.45,534.78,565.22,550.00,550.00,550.00,589.44,550.00,509.29,550.00,572.24,550.00,550.00,529.03,589.44,550.00,572.24,515.45,542.53,519.68,565.22,550.00,565.22,542.53,550.00,565.22,550.00,542.53,550.00,515.45,497.13,515.45,565.22,519.68,589.44,550.00,550.00;
529.03,529.03,534.78,565.22,501.89,529.03,534.78,555.15,529.03,589.44,534.78,572.24,509.29,572.24,529.03,550.00,529.03,589.44,550.00,580.27,542.53,565.22,534.78,529.03,572.24,589.44,550.00,565.22,572.24,550.00,550.00,555.15,550.00,555.15,515.45,542.53,572.24,538.32,555.15,565.22;
515.45,550.00,565.22,542.53,529.03,534.78,550.00,565.22,550.00,589.44,550.00,550.00,550.00,565.22,529.03,565.22,529.03,565.22,542.53,589.44,515.45,550.00,509.29,550.00,542.53,589.44,550.00,589.44,589.44,589.44,550.00,572.24,515.45,534.78,534.78,550.00,572.24,572.24,550.00,572.24;
529.03,534.78,515.45,529.03,550.00,565.22,550.00,580.27,550.00,529.03,521.29,529.03,515.45,572.24,550.00,572.24,550.00,589.44,550.00,555.15,534.78,615.27,550.00,565.22,529.03,572.24,589.44,589.44,606.57,589.44,515.45,529.03,515.45,515.45,534.78,550.00,572.24,589.44,565.22,534.78;
565.22,534.78,542.53,529.03,550.00,550.00,534.78,565.22,550.00,589.44,529.03,534.78,529.03,550.00,550.00,529.03,589.44,589.44,534.78,572.24,529.03,534.78,565.22,606.57,550.00,565.22,565.22,589.44,572.24,589.44,529.03,550.00,529.03,497.13,529.03,572.24,572.24,572.24,534.78,550.00;
529.03,529.03,550.00,515.45,515.45,565.22,529.03,589.44,542.53,565.22,534.78,565.22,515.45,565.22,550.00,565.22,572.24,606.57,550.00,572.24,550.00,565.22,534.78,550.00,572.24,589.44,529.03,565.22,572.24,589.44,550.00,529.03,550.00,529.03,529.03,589.44,550.00,580.27,589.44,572.24;
519.68,550.00,534.78,534.78,529.03,572.24,572.24,550.00,550.00,589.44,515.45,515.45,534.78,565.22,534.78,550.00,529.03,589.44,565.22,550.00,534.78,565.22,542.53,572.24,572.24,589.44,550.00,572.24,572.24,565.22,534.78,529.03,572.24,497.13,542.53,565.22,589.44,595.79,572.24,529.03;
534.78,529.03,542.53,529.03,542.53,572.24,550.00,550.00,550.00,534.78,529.03,550.00,529.03,550.00,529.03,589.44,534.78,589.44,550.00,572.24,515.45,550.00,550.00,565.22,550.00,589.44,550.00,572.24,565.22,565.22,550.00,550.00,515.45,529.03,515.45,550.00,565.22,550.00,572.24,515.45];

mean_0=mean(baseline)';
mean_1=mean(frame)';

img_mean= inv_solve( inv_model, mean_0, mean_1);
show_fem(img_mean,1);

%% media pennarello 1-2 0906

n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

frame_2=[534.78,542.53,550.00,550.00,550.00,534.78,515.45,515.45,529.03,565.22,555.15,565.22,501.89,572.24,550.00,542.53,534.78,550.00,565.22,589.44,497.13,606.57,550.00,542.53,550.00,606.57,550.00,606.57,542.53,589.44,550.00,529.03,542.53,515.45,534.78,550.00,534.78,589.44,550.00,542.53;
515.45,550.00,534.78,534.78,529.03,550.00,550.00,572.24,534.78,589.44,534.78,515.45,529.03,589.44,550.00,565.22,565.22,565.22,550.00,589.44,529.03,550.00,550.00,550.00,542.53,589.44,534.78,615.27,565.22,565.22,534.78,534.78,529.03,509.29,555.15,550.00,550.00,572.24,565.22,572.24;
515.45,529.03,534.78,565.22,572.24,572.24,529.03,550.00,542.53,565.22,515.45,565.22,497.13,589.44,550.00,565.22,550.00,589.44,529.03,572.24,497.13,542.53,550.00,550.00,534.78,595.79,565.22,589.44,550.00,555.15,550.00,550.00,542.53,542.53,529.03,550.00,572.24,572.24,550.00,572.24;
542.53,534.78,572.24,534.78,529.03,572.24,529.03,550.00,572.24,550.00,534.78,515.45,501.89,589.44,515.45,529.03,534.78,589.44,534.78,565.22,529.03,589.44,550.00,565.22,572.24,615.27,572.24,589.44,589.44,550.00,550.00,589.44,529.03,497.13,529.03,550.00,534.78,550.00,572.24,589.44;
572.24,565.22,534.78,529.03,550.00,572.24,534.78,572.24,542.53,572.24,550.00,534.78,529.03,572.24,550.00,572.24,550.00,572.24,550.00,589.44,529.03,550.00,550.00,589.44,572.24,550.00,534.78,550.00,589.44,580.27,550.00,572.24,515.45,550.00,529.03,550.00,550.00,565.22,565.22,555.15;
550.00,550.00,529.03,550.00,515.45,565.22,542.53,572.24,550.00,565.22,565.22,550.00,534.78,572.24,542.53,550.00,529.03,589.44,565.22,589.44,529.03,550.00,565.22,565.22,572.24,589.44,555.15,595.79,580.27,550.00,529.03,565.22,534.78,515.45,550.00,565.22,565.22,589.44,565.22,589.44;
515.45,550.00,550.00,529.03,497.13,565.22,550.00,572.24,550.00,550.00,550.00,550.00,550.00,572.24,565.22,589.44,515.45,589.44,534.78,589.44,509.29,589.44,572.24,529.03,534.78,542.53,550.00,565.22,589.44,572.24,515.45,555.15,534.78,515.45,515.45,565.22,565.22,572.24,550.00,572.24;
534.78,572.24,534.78,529.03,515.45,589.44,529.03,565.22,529.03,550.00,565.22,534.78,515.45,615.27,529.03,589.44,529.03,589.44,550.00,550.00,479.79,550.00,515.45,572.24,589.44,550.00,529.03,615.27,589.44,589.44,529.03,550.00,515.45,501.89,550.00,572.24,550.00,589.44,550.00,534.78;
534.78,572.24,519.68,529.03,550.00,550.00,565.22,565.22,572.24,550.00,572.24,515.45,542.53,589.44,529.03,572.24,542.53,589.44,529.03,572.24,515.45,565.22,550.00,529.03,550.00,606.57,550.00,565.22,565.22,572.24,529.03,529.03,529.03,515.45,515.45,589.44,550.00,565.22,550.00,550.00;
550.00,550.00,550.00,550.00,515.45,550.00,529.03,550.00,550.00,565.22,565.22,565.22,542.53,589.44,550.00,572.24,550.00,589.44,550.00,589.44,529.03,589.44,550.00,529.03,542.53,580.27,565.22,589.44,580.27,565.22,550.00,515.45,542.53,515.45,515.45,589.44,550.00,589.44,550.00,555.15];


mean_2=mean(frame_2)';

img_mean_2= inv_solve( inv_model, mean_0, mean_2);
show_fem(img_mean_2,1);

%% penn dritto 3-4 0906

n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

frame_3=[550.00,550.00,550.00,529.03,550.00,572.24,572.24,550.00,529.03,589.44,572.24,589.44,529.03,589.44,542.53,606.57,550.00,589.44,529.03,589.44,529.03,589.44,572.24,565.22,565.22,572.24,550.00,580.27,589.44,555.15,550.00,534.78,550.00,550.00,542.53,589.44,589.44,572.24,572.24,572.24;
542.53,565.22,529.03,555.15,550.00,565.22,515.45,572.24,550.00,565.22,529.03,550.00,497.13,565.22,565.22,589.44,534.78,589.44,550.00,615.27,509.29,565.22,572.24,589.44,565.22,589.44,542.53,565.22,589.44,550.00,572.24,589.44,534.78,550.00,529.03,589.44,589.44,565.22,550.00,550.00;
565.22,565.22,529.03,572.24,550.00,550.00,565.22,572.24,550.00,572.24,550.00,529.03,515.45,589.44,555.15,550.00,550.00,589.44,555.15,589.44,501.89,595.79,529.03,589.44,550.00,572.24,589.44,589.44,572.24,565.22,542.53,589.44,550.00,550.00,515.45,589.44,572.24,589.44,572.24,550.00;
542.53,572.24,534.78,550.00,534.78,565.22,565.22,565.22,529.03,565.22,572.24,515.45,497.13,589.44,534.78,576.58,565.22,606.57,572.24,589.44,529.03,589.44,565.22,589.44,572.24,589.44,550.00,580.27,589.44,589.44,519.68,565.22,529.03,521.29,542.53,589.44,565.22,589.44,572.24,565.22;
519.68,534.78,550.00,565.22,550.00,565.22,550.00,550.00,529.03,572.24,550.00,550.00,509.29,589.44,550.00,572.24,529.03,589.44,589.44,589.44,529.03,589.44,550.00,589.44,589.44,589.44,550.00,589.44,589.44,589.44,550.00,589.44,550.00,542.53,534.78,589.44,565.22,589.44,595.79,550.00;
565.22,534.78,529.03,529.03,521.29,550.00,550.00,565.22,555.15,565.22,565.22,534.78,529.03,572.24,542.53,589.44,550.00,550.00,572.24,589.44,515.45,572.24,550.00,572.24,572.24,565.22,550.00,589.44,565.22,565.22,550.00,550.00,589.44,534.78,501.89,589.44,550.00,565.22,542.53,565.22;
529.03,550.00,550.00,515.45,550.00,589.44,534.78,565.22,565.22,576.58,521.29,534.78,519.68,529.03,550.00,572.24,542.53,615.27,572.24,589.44,550.00,589.44,529.03,589.44,550.00,589.44,534.78,589.44,589.44,565.22,555.15,565.22,550.00,515.45,521.29,615.27,589.44,572.24,589.44,565.22;
529.03,529.03,534.78,534.78,572.24,550.00,550.00,589.44,529.03,565.22,572.24,550.00,542.53,572.24,550.00,550.00,542.53,572.24,529.03,572.24,501.89,572.24,589.44,606.57,589.44,565.22,550.00,595.79,572.24,589.44,529.03,572.24,529.03,501.89,529.03,565.22,550.00,580.27,589.44,550.00;
534.78,534.78,529.03,565.22,515.45,555.15,572.24,565.22,550.00,565.22,550.00,515.45,515.45,572.24,550.00,572.24,589.44,589.44,550.00,589.44,529.03,589.44,542.53,589.44,550.00,565.22,550.00,606.57,589.44,550.00,550.00,529.03,515.45,529.03,529.03,542.53,550.00,589.44,565.22,572.24;
589.44,542.53,529.03,534.78,521.29,589.44,542.53,550.00,550.00,565.22,529.03,565.22,515.45,572.24,515.45,589.44,565.22,572.24,534.78,550.00,515.45,572.24,515.45,589.44,550.00,589.44,550.00,606.57,572.24,565.22,542.53,572.24,529.03,515.45,515.45,589.44,529.03,589.44,572.24,589.44];

mean_3=mean(frame_3)';

img_mean_3= inv_solve( inv_model, mean_0, mean_3);
show_fem(img_mean_3,1);

%% penn dritto 5-6

n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

frame_4=[565.22,550.00,542.53,565.22,529.03,572.24,565.22,589.44,550.00,565.22,565.22,565.22,509.29,572.24,534.78,565.22,542.53,606.57,550.00,572.24,509.29,589.44,550.00,589.44,565.22,565.22,550.00,565.22,589.44,565.22,565.22,534.78,550.00,534.78,529.03,565.22,565.22,550.00,565.22,529.03;
565.22,550.00,550.00,565.22,550.00,589.44,534.78,589.44,534.78,542.53,565.22,529.03,497.13,623.44,550.00,606.57,529.03,606.57,572.24,572.24,529.03,606.57,550.00,565.22,565.22,565.22,572.24,589.44,565.22,542.53,550.00,550.00,515.45,529.03,529.03,550.00,550.00,589.44,534.78,589.44;
606.57,501.89,555.15,550.00,550.00,555.15,565.22,589.44,550.00,572.24,572.24,534.78,529.03,580.27,534.78,555.15,550.00,615.27,565.22,572.24,509.29,572.24,565.22,565.22,572.24,634.84,550.00,589.44,589.44,615.27,550.00,572.24,550.00,529.03,497.13,595.79,589.44,565.22,589.44,572.24;
550.00,529.03,534.78,572.24,550.00,550.00,534.78,589.44,534.78,589.44,565.22,565.22,534.78,606.57,534.78,565.22,542.53,589.44,534.78,555.15,534.78,550.00,529.03,550.00,555.15,589.44,572.24,589.44,589.44,555.15,550.00,542.53,550.00,529.03,501.89,550.00,589.44,589.44,589.44,550.00;
550.00,550.00,534.78,550.00,550.00,589.44,550.00,572.24,565.22,572.24,555.15,542.53,515.45,606.57,550.00,589.44,565.22,589.44,550.00,572.24,529.03,595.79,550.00,572.24,550.00,589.44,534.78,589.44,589.44,589.44,529.03,542.53,542.53,529.03,534.78,589.44,589.44,572.24,589.44,565.22;
529.03,529.03,550.00,529.03,515.45,572.24,529.03,565.22,529.03,589.44,550.00,534.78,501.89,615.27,565.22,589.44,555.15,565.22,572.24,565.22,529.03,595.79,542.53,606.57,529.03,589.44,529.03,572.24,606.57,589.44,529.03,572.24,534.78,529.03,534.78,550.00,589.44,555.15,572.24,572.24;
565.22,572.24,572.24,515.45,515.45,606.57,529.03,565.22,565.22,565.22,529.03,534.78,534.78,565.22,550.00,606.57,589.44,580.27,529.03,572.24,534.78,572.24,565.22,589.44,529.03,589.44,550.00,589.44,565.22,572.24,529.03,534.78,509.29,550.00,529.03,572.24,589.44,572.24,565.22,589.44;
550.00,550.00,550.00,515.45,572.24,589.44,534.78,565.22,550.00,572.24,529.03,550.00,550.00,572.24,529.03,589.44,572.24,595.79,550.00,589.44,497.13,550.00,550.00,572.24,589.44,572.24,529.03,589.44,572.24,565.22,572.24,565.22,550.00,529.03,550.00,589.44,589.44,589.44,550.00,572.24;
550.00,550.00,515.45,572.24,529.03,572.24,515.45,589.44,542.53,565.22,529.03,529.03,515.45,572.24,542.53,565.22,572.24,589.44,509.29,555.15,565.22,572.24,529.03,589.44,615.27,589.44,589.44,589.44,565.22,589.44,534.78,555.15,529.03,534.78,529.03,589.44,565.22,572.24,565.22,565.22;
529.03,529.03,529.03,534.78,534.78,572.24,550.00,572.24,550.00,572.24,565.22,534.78,550.00,565.22,565.22,572.24,515.45,589.44,572.24,565.22,550.00,572.24,534.78,572.24,565.22,615.27,550.00,572.24,589.44,589.44,589.44,572.24,550.00,550.00,555.15,572.24,550.00,572.24,589.44,572.24];

mean_4=mean(frame_4)';

img_mean_4= inv_solve( inv_model, mean_0, mean_4);
show_fem(img_mean_4,1);

%% penn dritto 7-8
n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

frame_5=[529.03,550.00,529.03,515.45,534.78,565.22,550.00,572.24,542.53,565.22,529.03,529.03,550.00,572.24,550.00,606.57,529.03,572.24,572.24,589.44,515.45,595.79,529.03,565.22,606.57,615.27,550.00,589.44,572.24,565.22,565.22,572.24,529.03,529.03,550.00,595.79,565.22,589.44,565.22,565.22;
550.00,529.03,529.03,521.29,515.45,565.22,550.00,565.22,589.44,572.24,534.78,529.03,497.13,589.44,534.78,550.00,550.00,615.27,565.22,589.44,515.45,572.24,529.03,542.53,550.00,580.27,550.00,589.44,550.00,589.44,572.24,589.44,565.22,534.78,515.45,565.22,572.24,572.24,572.24,550.00;
529.03,550.00,565.22,565.22,515.45,589.44,615.27,572.24,550.00,550.00,550.00,550.00,538.32,565.22,550.00,542.53,565.22,589.44,572.24,572.24,529.03,550.00,550.00,572.24,550.00,606.57,572.24,589.44,606.57,589.44,550.00,565.22,542.53,542.53,550.00,606.57,550.00,565.22,572.24,572.24;
572.24,529.03,542.53,589.44,550.00,572.24,529.03,572.24,542.53,550.00,565.22,550.00,529.03,565.22,529.03,565.22,550.00,615.27,572.24,565.22,509.29,589.44,542.53,572.24,550.00,550.00,589.44,565.22,589.44,572.24,550.00,529.03,550.00,589.44,550.00,565.22,565.22,615.27,589.44,572.24;
572.24,550.00,529.03,529.03,509.29,572.24,572.24,555.15,550.00,589.44,534.78,534.78,534.78,565.22,542.53,565.22,550.00,606.57,550.00,606.57,509.29,589.44,515.45,550.00,550.00,572.24,550.00,615.27,615.27,589.44,565.22,534.78,550.00,509.29,529.03,615.27,589.44,615.27,572.24,572.24;
589.44,550.00,550.00,550.00,529.03,550.00,515.45,589.44,555.15,572.24,550.00,497.13,515.45,589.44,550.00,589.44,529.03,589.44,529.03,595.79,529.03,606.57,529.03,565.22,542.53,589.44,529.03,572.24,565.22,589.44,550.00,572.24,534.78,550.00,534.78,565.22,572.24,589.44,572.24,550.00;
534.78,572.24,542.53,515.45,529.03,565.22,529.03,572.24,550.00,565.22,565.22,580.27,529.03,565.22,550.00,589.44,529.03,615.27,550.00,589.44,550.00,572.24,550.00,550.00,589.44,589.44,572.24,589.44,580.27,589.44,550.00,565.22,519.68,550.00,529.03,550.00,572.24,550.00,589.44,589.44;
529.03,529.03,529.03,529.03,534.78,589.44,589.44,572.24,529.03,634.84,550.00,515.45,550.00,615.27,515.45,572.24,529.03,606.57,565.22,565.22,501.89,550.00,515.45,589.44,550.00,589.44,572.24,615.27,572.24,589.44,572.24,572.24,529.03,534.78,529.03,550.00,589.44,589.44,565.22,565.22;
529.03,534.78,515.45,550.00,534.78,565.22,529.03,550.00,572.24,572.24,529.03,550.00,550.00,589.44,519.68,589.44,515.45,580.27,534.78,589.44,515.45,589.44,550.00,572.24,550.00,572.24,572.24,589.44,589.44,589.44,550.00,565.22,515.45,542.53,515.45,565.22,565.22,589.44,589.44,572.24;
550.00,529.03,515.45,515.45,529.03,565.22,589.44,589.44,565.22,572.24,542.53,515.45,534.78,589.44,529.03,565.22,550.00,589.44,565.22,589.44,529.03,589.44,550.00,550.00,572.24,589.44,565.22,589.44,580.27,572.24,529.03,580.27,542.53,538.32,509.29,572.24,572.24,550.00,572.24,529.03];
mean_5=mean(frame_5)';

img_mean_5= inv_solve( inv_model, mean_0, mean_5);
show_fem(img_mean_5,1);

%% bottiglia alcool 12/06
n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;
%a=[536.7088012695312,536.7088012695312,541.818359375,538.1353149414062,546.0943603515625,544.7117919921875,544.7117919921875,544.7117919921875,543.2860717773438,543.2860717773438,541.818359375,539.520751953125,548.5324096679688,544.7117919921875,534.4243774414062,551.4232788085938,544.7117919921875,546.0943603515625,543.2860717773438,544.7117919921875,538.1353149414062,543.2860717773438,538.1353149414062,548.5324096679688,543.2860717773438,555.3880004882812,538.1353149414062,549.9999389648438,551.4232788085938,549.9999389648438,541.818359375,544.7117919921875,539.520751953125,540.8640747070312,547.0219116210938,543.2860717773438,543.2860717773438,544.7117919921875,548.5324096679688,544.7117919921875]';
a=550*ones(40,1);
b=[543.2860717773438,538.1353149414062,531.6909790039062,544.7117919921875,544.7117919921875,543.2860717773438,543.2860717773438,543.2860717773438,543.2860717773438,543.2860717773438,538.1353149414062,544.7117919921875,541.818359375,544.7117919921875,538.1353149414062,538.1353149414062,543.2860717773438,549.9999389648438,543.2860717773438,546.0943603515625,543.2860717773438,544.7117919921875,539.520751953125,549.9999389648438,543.2860717773438,549.9999389648438,549.9999389648438,549.9999389648438,549.9999389648438,548.5324096679688,536.7088012695312,546.0943603515625,551.4232788085938,541.818359375,544.7117919921875,544.7117919921875,543.2860717773438,543.2860717773438,543.2860717773438,543.2860717773438]';
img_bottiglia= inv_solve( inv_model, a, b);
show_fem(img_bottiglia,1);

%% bottiglia al centro
n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=20; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

bott=[537.89,540.73,546.05,537.89,539.33,531.31,537.89,526.30,534.89,526.30,531.31,532.75,542.08,527.70,539.33,522.74,531.31,532.75,550.00,532.75,546.05,527.70,544.62,527.70,536.41,534.15,540.73,534.15,532.75,532.75,544.62,529.06,531.31,550.00,539.33,529.06,526.30,526.30,536.41,527.70]';
bott1=[544.62,546.05,550.00,537.89,539.33,532.75,536.41,534.15,532.75,524.06,532.75,532.75,543.13,527.70,540.73,527.70,526.30,539.33,539.33,532.75,544.62,532.75,544.62,537.89,531.31,524.06,537.89,534.15,534.15,532.75,543.13,526.30,529.83,550.00,546.05,527.70,536.41,532.75,532.75,527.70]';
bott2=[544.62,537.89,544.62,537.89,536.41,531.31,537.89,527.70,531.31,531.31,534.89,529.06,539.33,526.30,546.05,534.15,532.75,532.75,534.15,537.89,537.89,534.15,543.13,534.15,532.75,534.15,537.89,532.75,527.70,527.70,544.62,526.30,531.31,551.48,543.13,531.31,526.30,531.31,527.70,524.86]';
bott3=[543.13,544.62,551.48,543.13,543.13,532.75,532.75,527.70,531.31,526.30,532.75,531.31,544.62,534.15,551.48,532.75,532.75,532.75,548.47,537.89,540.73,532.75,540.73,532.75,531.31,532.75,537.89,534.15,532.75,527.70,536.41,527.70,537.89,544.62,544.62,527.70,532.75,534.15,529.83,527.70]';
bott4=[546.05,543.13,550.00,537.89,537.89,532.75,546.05,527.70,536.41,527.70,536.41,532.75,543.13,529.06,544.62,532.75,532.75,527.70,539.33,529.06,537.89,531.31,543.13,532.75,531.31,527.70,539.33,534.15,527.70,532.75,532.75,527.70,532.75,550.00,544.62,527.70,527.70,526.30,536.41,526.30]';



img_bott_1=inv_solve(inv_model, bott,bott1);
img_bott_2=inv_solve(inv_model, bott,bott2);
img_bott_3=inv_solve(inv_model, bott,bott3);
img_bott_4=inv_solve(inv_model, bott,bott4);


img_bott_1.calc_colours.ref_level=0;
img_bott_2.calc_colours.ref_level=0;
img_bott_3.calc_colours.ref_level=0;
img_bott_4.calc_colours.ref_level=0;

ax_bott_1 = subplot(1,4,1);
show_fem(img_bott_1,1)
ax_bott_2 = subplot(1,4,2);
show_fem(img_bott_2,1)
ax_bott_3 = subplot(1,4,3);
show_fem(img_bott_3,1)
ax_bott_4 = subplot(1,4,4);
show_fem(img_bott_4,1)
axis equal


%% bottiglia opposite
n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=20; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{op}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

opp_0=[562.38,562.38,562.38,551.47,544.74,544.74,544.74,556.87,555.36,551.47,563.89,544.74,551.47,573.71,539.58,550.00,546.93,553.80,562.38,550.00,550.00,546.17,544.74,539.58,538.14,551.47,544.74,543.27,543.27,544.74,573.71,567.99]';
%opp_0=550*ones(32,1);
opp_1=[567.99,558.34,556.87,556.87,544.74,550.00,543.27,563.89,550.00,562.38,558.34,544.74,567.99,560.82,543.27,551.47,548.49,556.87,555.36,555.36,555.36,546.17,546.17,544.74,543.27,556.87,550.00,556.87,550.00,538.14,573.71,572.05]';
opp_2=[562.38,562.38,567.99,552.90,539.58,546.17,544.74,563.89,543.27,556.87,563.89,544.74,558.34,560.82,538.14,555.36,556.87,556.87,556.87,548.49,550.00,540.96,544.74,544.74,541.76,562.38,550.00,553.80,550.00,539.58,567.99,566.38]';
opp_3=[562.38,558.34,563.89,551.47,546.17,539.58,539.58,555.36,551.47,551.47,558.34,544.74,573.71,567.99,544.74,556.87,555.36,560.82,562.38,556.87,556.87,544.74,539.58,539.58,539.58,563.89,551.47,550.00,550.00,539.58,566.38,560.82]';
opp_4=[567.99,563.89,569.55,552.90,548.49,555.36,543.27,562.38,555.36,556.87,565.36,555.36,573.71,567.99,562.38,562.38,558.34,563.89,562.38,555.36,569.55,544.74,544.74,543.27,548.49,563.89,555.36,562.38,556.87,556.87,567.99,562.38]';

img_opp_1=inv_solve(inv_model, opp_0,opp_1);
img_opp_2=inv_solve(inv_model, opp_0,opp_2);
img_opp_3=inv_solve(inv_model, opp_0,opp_3);
img_opp_4=inv_solve(inv_model, opp_0,opp_4);


img_opp_1.calc_colours.ref_level=0;
img_opp_2.calc_colours.ref_level=0;
img_opp_3.calc_colours.ref_level=0;
img_opp_4.calc_colours.ref_level=0;

ax_opp_1 = subplot(1,4,1);
show_fem(img_opp_1,1)
ax_opp_2 = subplot(1,4,2);
show_fem(img_opp_2,1)
ax_opp_3 = subplot(1,4,3);
show_fem(img_opp_3,1)
ax_opp_4 = subplot(1,4,4);
show_fem(img_opp_4,1)
axis equal

%% 2 dita gaia centro
n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('d2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

d0a=[553.90,548.50,550.00,548.50,543.21,539.43,538.02,539.43,536.56,532.91,538.02,538.02,538.02,534.29,544.66,539.43,538.02,543.21,543.21,548.50,536.56,539.43,550.00,538.02,534.29,538.02,541.72,538.02,538.02,543.21,543.21,538.02,538.02,532.91,532.91,538.02,532.91,538.02,538.02,538.02]';
%d0a=550.00*ones(40,1);
d1a=[543.21,541.72,544.66,541.72,541.72,538.02,538.02,544.66,532.91,538.02,539.43,534.29,538.02,538.02,544.66,532.91,538.02,539.43,550.00,536.56,532.91,538.02,548.50,531.50,534.29,543.21,536.56,544.66,534.29,538.02,536.56,550.00,539.43,526.53,531.50,538.02,539.43,544.66,538.02,538.02]';
d2a=[555.44,544.66,555.44,543.21,541.72,531.50,541.72,538.02,532.91,538.02,536.56,539.43,527.91,538.02,546.07,536.56,544.66,546.07,543.21,539.43,531.50,531.50,543.21,539.43,526.53,536.56,538.02,544.66,539.43,544.66,538.02,543.21,532.91,527.91,531.50,539.43,539.43,538.02,538.02,539.43]';
d3a=[548.50,548.50,555.44,536.56,544.66,538.02,538.02,543.21,531.50,536.56,532.91,527.91,531.50,538.02,544.66,539.43,532.91,540.80,548.50,538.02,531.50,534.29,551.45,532.91,538.02,544.66,536.56,538.02,544.66,543.21,536.56,543.21,532.91,538.02,538.02,544.66,538.02,544.66,543.21,539.43]';
d4a=[548.50,543.21,544.66,539.43,543.21,538.02,539.43,538.02,532.91,532.91,532.91,532.91,532.91,538.02,548.50,532.91,527.91,550.00,551.45,543.21,532.91,544.66,551.45,532.91,532.91,544.66,531.50,548.50,538.02,538.02,536.56,532.91,538.02,532.91,536.56,544.66,532.91,539.43,539.43,532.91]';

img1da= inv_solve( inv_model, d0a, d1a);
img2da= inv_solve( inv_model, d0a, d2a);
img3da= inv_solve( inv_model, d0a, d3a);
img4da= inv_solve( inv_model, d0a, d4a);

ax1da = subplot(1,4,1);
show_fem(img1da,1)
ax2da = subplot(1,4,2);
show_fem(img2da,1)
ax3da = subplot(1,4,3);
show_fem(img3da,1)
ax4da = subplot(1,4,4);
show_fem(img4da,1)

%% mean dito
n_elec = 8;
n_rings= 1;
options = {'no_meas_current','no_rotate_meas'};
amplitude=2; %amplitude of stimulation current, default=10mA
[st, ms]= mk_stim_patterns(n_elec, n_rings, '{ad}','{ad}', options, amplitude);
inv_model= mk_common_model('f2c0',n_elec); %1024 elementi
inv_model.fwd_model.stimulation = st;
inv_model.fwd_model.meas_select = ms;

frame_2=[546.07,541.72,541.72,538.02,541.72,535.62,532.91,541.72,539.43,543.21,538.02,543.21,538.02,538.02,550.00,543.21,543.21,531.50,550.00,543.21,534.29,539.43,543.21,543.21,532.91,532.91,536.56,543.21,543.21,548.50,538.02,538.02,539.43,538.02,532.91,539.43,534.29,539.43,539.43,538.02;
550.00,541.72,548.50,532.91,541.72,532.91,538.02,539.43,534.29,532.91,532.91,538.02,534.29,539.43,543.21,539.43,538.02,536.56,543.21,539.43,538.02,539.43,546.07,532.91,539.43,541.72,532.91,538.02,539.43,538.02,532.91,538.02,538.02,534.29,526.53,544.66,539.43,541.72,532.91,539.43;
543.21,543.21,555.44,531.50,544.66,539.43,538.02,538.02,539.43,539.43,532.91,534.29,531.50,539.43,544.66,541.72,538.02,544.66,548.50,543.21,532.91,541.72,544.66,532.91,538.02,543.21,538.02,543.21,541.72,541.72,531.50,531.50,538.02,534.29,531.50,538.02,539.43,543.21,538.02,538.02;
544.66,543.21,548.50,536.56,536.56,543.21,543.21,538.02,538.02,532.91,532.91,538.02,534.29,538.02,543.21,548.50,532.91,539.43,550.00,543.21,532.91,544.66,544.66,534.29,538.02,544.66,541.72,544.66,543.21,531.50,532.91,543.21,531.50,532.91,532.91,543.21,539.43,544.66,532.91,538.02;
543.21,541.72,553.90,539.43,543.21,532.91,532.91,544.66,527.91,539.43,543.21,539.43,536.56,538.02,544.66,544.66,539.43,538.02,550.00,538.02,538.02,538.02,543.21,538.02,539.43,543.21,531.50,543.21,543.21,544.66,526.53,536.56,538.02,538.02,532.91,541.72,538.02,544.66,538.02,544.66;
543.21,543.21,548.50,541.72,541.72,532.91,536.56,544.66,534.29,538.02,538.02,532.91,532.91,538.02,548.50,532.91,539.43,544.66,543.21,538.02,538.02,539.43,543.21,539.43,538.02,543.21,538.02,544.66,539.43,543.21,532.91,544.66,538.02,538.02,532.91,539.43,538.02,544.66,532.91,541.72;
544.66,543.21,546.07,538.02,536.56,538.02,538.02,539.43,538.02,538.02,534.29,538.02,534.29,539.43,544.66,538.02,543.21,538.02,550.00,546.07,532.91,539.43,550.00,539.43,534.29,536.56,543.21,543.21,538.02,538.02,538.02,538.02,534.29,538.02,534.29,539.43,534.29,543.21,538.02,531.50;
543.21,543.21,550.00,536.56,532.91,531.50,536.56,538.02,531.50,543.21,538.02,538.02,532.91,532.91,550.00,538.02,539.43,543.21,552.31,548.50,532.91,539.43,548.50,543.21,536.56,544.66,536.56,544.66,539.43,538.02,538.02,544.66,538.02,527.91,531.50,539.43,539.43,544.66,534.29,538.02;
553.90,543.21,550.00,538.02,543.21,544.66,541.72,538.02,532.91,539.43,527.91,539.43,532.91,538.02,550.00,532.91,544.66,536.56,543.21,541.72,538.02,539.43,543.21,538.02,532.91,543.21,532.91,543.21,543.21,536.56,538.02,541.72,538.02,538.02,534.29,543.21,539.43,531.50,532.91,538.02;
550.00,541.72,548.50,536.56,543.21,532.91,532.91,538.02,538.02,543.21,538.02,532.91,531.50,538.02,544.66,536.56,539.43,538.02,543.21,538.02,532.91,544.66,550.00,543.21,531.50,539.43,538.02,538.02,543.21,538.02,538.02,536.56,534.29,532.91,534.29,539.43,538.02,532.91,531.50,543.21];
mean_2=mean(frame_2)';

frame_3=[551.45,543.21,550.00,536.56,543.21,539.43,539.43,538.02,534.29,539.43,531.50,538.02,531.50,540.80,548.50,532.91,539.43,548.50,543.21,543.21,531.50,543.21,544.66,544.66,538.02,543.21,538.02,543.21,543.21,544.66,531.50,539.43,538.02,534.29,536.56,538.02,536.56,531.50,531.50,536.56;
550.00,541.72,548.50,538.02,544.66,539.43,541.72,543.21,544.66,539.43,538.02,538.02,532.91,532.91,550.00,543.21,538.02,536.56,543.21,543.21,538.02,539.43,544.66,534.29,532.91,539.43,536.56,532.91,548.50,541.72,536.56,541.72,539.43,534.29,532.91,544.66,539.43,539.43,531.50,544.66;
544.66,548.50,543.21,538.02,543.21,543.21,538.02,538.02,538.02,536.56,536.56,532.91,532.91,538.02,550.00,541.72,550.00,538.02,544.66,539.43,534.29,532.91,548.50,538.02,532.91,536.56,535.07,531.50,536.56,543.21,532.91,541.72,539.43,527.91,531.50,539.43,538.02,544.66,536.56,538.02;
539.43,538.02,551.45,534.29,538.02,532.91,538.02,538.02,532.91,538.02,536.56,538.02,536.56,532.91,544.66,541.72,539.43,543.21,548.50,543.21,531.50,532.91,543.21,543.21,532.91,543.21,543.21,548.50,536.56,546.96,531.50,536.56,532.91,538.02,535.07,539.43,538.02,538.02,539.43,536.56;
543.21,543.21,544.66,538.02,544.66,538.02,539.43,539.43,532.91,543.21,534.29,539.43,538.02,538.02,556.93,538.02,538.02,543.21,548.50,543.21,534.29,543.21,550.00,534.29,538.02,543.21,535.07,538.02,543.21,543.21,526.53,541.72,539.43,538.02,532.91,538.02,536.56,538.02,531.50,536.56;
544.66,548.50,548.50,536.56,543.21,543.21,538.02,532.91,536.56,538.02,538.02,534.29,538.02,534.29,550.00,538.02,535.62,543.21,550.00,543.21,532.91,532.91,556.93,538.02,532.91,538.02,538.02,541.72,548.50,541.72,538.02,544.66,532.91,532.91,532.91,543.21,532.91,543.21,532.91,543.21;
546.07,543.21,550.00,536.56,543.21,539.43,538.02,538.02,531.50,539.43,534.29,539.43,531.50,532.91,543.21,543.21,548.50,543.21,548.50,541.72,532.91,536.56,543.21,538.02,532.91,543.21,538.02,541.72,539.43,538.02,534.29,538.02,540.80,532.91,532.91,538.02,538.02,540.80,538.02,536.56;
550.00,543.21,544.66,538.02,538.02,532.91,538.02,539.43,532.91,532.91,536.56,534.29,531.50,544.66,550.00,538.02,539.43,538.02,543.21,538.02,532.91,531.50,553.90,538.02,534.29,548.50,532.91,536.56,534.29,541.72,541.72,534.29,534.29,534.29,532.91,539.43,531.50,544.66,534.29,538.02;
550.00,543.21,548.50,539.43,536.56,538.02,543.21,541.72,536.56,539.43,538.02,539.43,532.91,539.43,548.50,538.02,543.21,531.50,550.00,538.02,536.56,532.91,551.45,539.43,532.91,532.91,543.21,543.21,544.66,550.00,538.02,543.21,538.02,534.29,529.24,539.43,538.02,539.43,534.29,541.72;
550.00,548.50,550.00,543.21,543.21,538.02,538.02,539.43,538.02,544.66,543.21,543.21,536.56,546.07,553.90,540.18,539.43,538.02,550.00,544.66,538.02,538.02,550.00,543.21,538.02,539.43,543.21,541.72,536.56,543.21,538.02,539.43,539.43,532.91,529.24,532.91,534.29,539.43,532.91,543.21];
mean_3=mean(frame_3)';

%mean_4=550*ones(40,1);

img_mean_3= inv_solve( inv_model, mean_2, mean_3);
show_fem(img_mean_3,1);

%%

